<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MKQSBEKBG0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MKQSBEKBG0');
</script>
  <title>Aunikah - Smart Work Assistant</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display:flex; flex-direction:column; padding:20px;
    }
    .chat-container {
      width:100%; max-width:900px; height:calc(100vh - 40px);
      background:white; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.3);
      display:flex; flex-direction:column; overflow:hidden; margin:0 auto;
    }
    .chat-header { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px; }
    .header-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:15px; }
    .header-info { display:flex; align-items:center; gap:15px; }
    .bot-avatar {
      width:50px; height:50px; background:white; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:24px; font-weight:bold; color:#667eea;
    }
    .header-text h1 { font-size:22px; margin-bottom:5px; }
    .header-text p { font-size:14px; opacity:0.9; }
    .badge { display:inline-block; padding:4px 10px; border-radius:12px; font-size:11px; font-weight:600; margin-left:8px; }
    .badge-detection { background:rgba(255,255,255,0.3); }
    .badge-client { background:rgba(66,153,225,0.3); }
    .badge-employer { background:rgba(159,122,234,0.3); }
    .mode-selector { display:flex; gap:10px; }
    .mode-btn {
      padding:8px 16px; background:rgba(255,255,255,0.2); border:2px solid rgba(255,255,255,0.3);
      border-radius:20px; color:white; cursor:pointer; font-size:13px; transition:all 0.3s;
    }
    .mode-btn:hover { background:rgba(255,255,255,0.3); }
    .mode-btn.active { background:white; color:#667eea; border-color:white; }
    .demo-notice { background:rgba(255,255,255,0.15); padding:12px; border-radius:10px; font-size:13px; }
    .demo-notice strong { display:block; margin-bottom:5px; }
    .chat-messages { flex:1; overflow-y:auto; padding:20px; background:#f8f9fa; }
    .message { display:flex; gap:10px; margin-bottom:15px; animation:slideIn 0.3s ease; }
    @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .message.user { flex-direction:row-reverse; }
    .message-avatar {
      width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-weight:bold; color:white; flex-shrink:0; font-size:14px;
    }
    .message.bot .message-avatar { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
    .message.user .message-avatar { background:#6c757d; }
    .message-content { max-width:70%; padding:12px 16px; border-radius:12px; line-height:1.6; }
    .message.bot .message-content { background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); color:#333; }
    .message.bot .message-content strong { font-weight:600; color:#667eea; }
    .message.user .message-content { background:#667eea; color:white; }
    .typing-indicator { display:none; padding:15px; background:white; border-radius:12px; width:fit-content; }
    .typing-indicator.active { display:flex; gap:4px; }
    .typing-dot { width:8px; height:8px; border-radius:50%; background:#667eea; animation:typing 1.4s infinite; }
    .typing-dot:nth-child(2){ animation-delay:0.2s; }
    .typing-dot:nth-child(3){ animation-delay:0.4s; }
    @keyframes typing { 0%,60%,100%{transform:translateY(0);} 30%{transform:translateY(-10px);} }
    .chat-input-container { padding:20px; background:white; border-top:1px solid #e9ecef; }
    .chat-input-wrapper { display:flex; gap:10px; }
    .chat-input {
      flex:1; padding:12px 20px; border:2px solid #e9ecef; border-radius:25px; font-size:15px; outline:none; transition:border-color 0.2s;
    }
    .chat-input:focus { border-color:#667eea; }
    .send-btn {
      padding:12px 24px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border:none; border-radius:25px;
      cursor:pointer; font-weight:bold; transition:transform 0.2s; font-size:14px;
    }
    .send-btn:hover { transform:scale(1.05); }
    .send-btn:disabled { opacity:0.5; cursor:not-allowed; }
    .suggestions { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .suggestion-btn {
      padding:8px 15px; background:#f0f4ff; border:1px solid #667eea; border-radius:20px; cursor:pointer; font-size:13px;
      color:#667eea; transition:all 0.2s; font-weight:500; border:none;
    }
    .suggestion-btn:hover { background:#667eea; color:white; transform:translateY(-2px); box-shadow:0 4px 8px rgba(102,126,234,0.2); }
    .setup-btn {
      padding:10px 20px; background:#667eea; color:white; border:none; border-radius:20px; cursor:pointer; font-size:14px;
      font-weight:600; transition:all 0.2s; margin:5px;
    }
    .setup-btn:hover { background:#5568d3; transform:translateY(-2px); box-shadow:0 4px 8px rgba(102,126,234,0.3); }
    .reset-btn {
      background:rgba(255,255,255,0.3); border:none; color:white; padding:6px 14px; 
      border-radius:15px; cursor:pointer; font-size:12px; margin-left:10px; transition:all 0.2s;
    }
    .reset-btn:hover { background:rgba(255,255,255,0.5); }
    @media (max-width:768px) {
      .chat-container { height:100vh; border-radius:0; }
      .message-content { max-width:85%; }
      .mode-selector { flex-direction:column; gap:5px; }
    }
    .footer { text-align:center; padding:15px; color:rgba(255,255,255,0.9); font-size:14px; font-weight:500; }
  </style>
</head>
<body>
  <div style="max-width:900px;margin:0 auto 20px;background:rgba(255,255,255,0.95);padding:15px 20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="color:#667eea;margin:0 0 8px 0;font-size:20px;">üëã Welcome to Aunikah</h2>
    <p style="color:#666;margin:0 0 10px 0;font-size:14px;line-height:1.5;">
      AI-powered HR assistant that helps team members navigate benefits, PTO, and payroll, and helps managers support their contingent teams.
    </p>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <span style="background:#f0f4ff;color:#667eea;padding:3px 10px;border-radius:12px;font-size:12px;">üß† Smart routing</span>
      <span style="background:#f0f4ff;color:#667eea;padding:3px 10px;border-radius:12px;font-size:12px;">‚öñÔ∏è Compliance-aware</span>
      <span style="background:#f0f4ff;color:#667eea;padding:3px 10px;border-radius:12px;font-size:12px;">üíº Manager support</span>
    </div>
  </div>

  <div class="chat-container">
    <div class="chat-header">
      <div class="header-top">
        <div class="header-info">
          <div class="bot-avatar">A</div>
          <div class="header-text">
            <h1>Aunikah</h1>
            <p id="modeDescription">
              Your Work Assistant
              <span id="detectionBadge"></span>
              <span id="clientBadge"></span>
              <span id="employerBadge"></span>
            </p>
          </div>
        </div>
        <div class="mode-selector">
          <button class="mode-btn active" onclick="switchMode('employee', event)">üë§ Team Member</button>
          <button class="mode-btn" onclick="switchMode('manager', event)">üëî Manager</button>
        </div>
      </div>

      <div class="demo-notice">
        <strong>üí¨ Chat-Based Setup</strong>
        I'll guide you through a quick setup, then answer your questions!
        <button class="reset-btn" onclick="resetSetup()">Start Over</button>
        <div style="margin-top:8px;font-size:11px;opacity:0.9;">
          ‚ö†Ô∏è <strong>Demo Only:</strong> All names, companies, benefits, and policies are fictional examples for demonstration purposes.
        </div>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages"></div>

    <div class="chat-input-container">
      <div class="chat-input-wrapper">
        <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything..." onkeypress="handleKeyPress(event)">
        <button class="send-btn" onclick="handleSend()">Send</button>
      </div>
    </div>
  </div>

  <div class="footer">
    ¬© <span id="year"></span> Amy Bray. All rights reserved.
  </div>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ---------- State ----------
    let currentMode = 'employee';
    let clientCompany = null;
    let employerCompany = null;
    let detectedType = null;
    let setupComplete = false;
    let selectedEmployee = null;
    let faqData = null;

    // Demo team member database (in production, this would be an API call)
    const employeeDatabase = {
      'Abby Martinez': { type: 'W2_Contingent', client: 'UnBungle', employer: 'Employee Stand' },
      'Mary Thompson': { type: 'W2_Contingent', client: 'Metadata TechCo', employer: 'ADevco' },
      'Claudia Park': { type: '1099', client: 'Micro Operators', employer: null },
      'Sarah Chen': { type: 'W2_Contingent', client: 'UnBungle', employer: 'Employee Stand' },
      'Marcus Johnson': { type: '1099', client: 'Micro Operators', employer: null },
      'Elena Rodriguez': { type: 'W2_Contingent', client: 'Amazing Floors', employer: 'ADevco' },
      'James Park': { type: 'W2_Contingent', client: 'Metadata TechCo', employer: 'People Power' },
      'Lorena Williams': { type: '1099', client: 'UnBungle', employer: null },
      'Tom O\'Brien': { type: 'W2_Contingent', client: 'Micro Operators', employer: 'People Lite' }
    };

    // ---------- Helpers: Empathy & CARE ----------
    function needsEmpathy(msg) {
      const m = (msg || '').toLowerCase();
      return /(confus|frustrat|upset|angry|mad|annoy|why.*not|no one told|help|urgent|asap)/.test(m);
    }
    function wrapTone(baseText, msg) {
      const intro = needsEmpathy(msg) ? "I can help clarify and point you to the right place. " : "";
      return intro + baseText;
    }
    function careFormat({clarify, action, route, evidence}) {
      let out = "";
      if (clarify) out += `**What this means:** ${clarify}\n\n`;
      if (action)  out += `**Next steps:** ${action}\n\n`;
      if (route)   out += `**Who to contact:** ${route}\n\n`;
      if (evidence)out += `**Where to check:** ${evidence}\n`;
      return out.trim();
    }

    // ---------- EOR-specific benefit details ----------
    const eorBenefits = {
      'Employee Stand': {
        medical: 'Blue Cross Blue Shield PPO',
        pto_days: '15 vacation + 10 sick days',
        match_401k: '4% match (100% vested after 1 year)',
        enrollment_window: '30 days from hire or November open enrollment',
        portal: 'MyEmployee Stand benefits portal',
        payroll_schedule: 'Bi-weekly (every other Friday)'
      },
      'ADevco': {
        medical: 'Aetna HMO or PPO options',
        pto_days: '10 vacation + 5 sick days (increases after 2 years)',
        match_401k: '3% match (50% vested immediately)',
        enrollment_window: '60 days from hire or during annual enrollment',
        portal: 'ADevco Associate Portal',
        payroll_schedule: 'Weekly (every Friday)'
      },
      'People Power': {
        medical: 'United Healthcare Choice Plus',
        pto_days: '12 vacation + 8 sick days',
        match_401k: '5% match (vested immediately)',
        enrollment_window: '30 days from start date',
        portal: 'People PowerGroup MyPath',
        payroll_schedule: 'Bi-weekly (Fridays)'
      },
      'People Lite': {
        medical: 'Cigna Open Access Plus',
        pto_days: '20 vacation + 10 sick days',
        match_401k: '6% match (100% vested)',
        enrollment_window: '45 days from hire',
        portal: 'PL Connect Benefits Hub',
        payroll_schedule: 'Bi-weekly (Thursdays)'
      }
    };

    // ---------- Typos mapping ----------
    const typos = {
      'benifits':'benefits','benfits':'benefits','bennefits':'benefits',
      'vaccation':'vacation','vacaton':'vacation',
      'insurence':'insurance','insuranse':'insurance',
      'holliday':'holiday','sallary':'salary',
      'payed':'paid','pade':'paid',
      'timeoff':'time off','sicke':'sick'
    };

    // ---------- Demo FAQ data ----------
    const demoData = {
      employee: [
        {
          id: 'emp_who_eor_w2',
          keywords: ['eor','employer of record','staffing','agency','who is my employer'],
          types: ['W2_Contingent'],
          answer: "üìã **Understanding Your W-2 Contingent Status**\n\n**Who's your employer?**\nCheck your paystub‚Äîthe company listed there is your legal employer.\n\n**As a W-2 Contingent worker:**\n‚Ä¢ You do your work at **[Client Company]**\n‚Ä¢ **[EOR]** is on your paystub (e.g., Employee Stand, ADevco, People Power)\n‚Ä¢ **[EOR]** = your legal employer (pay, benefits, taxes)\n‚Ä¢ **[Client Company]** = where you do the work\n\n**Who handles what:**\n‚Ä¢ Pay, benefits, PTO, taxes, W-2 ‚Üí **[EOR]**\n‚Ä¢ Daily work, tasks, projects ‚Üí your supervisor at **[Client Company]**\n\nAunikah helps you route questions to the right place."
        },
        {
          id: 'emp_benefits_w2',
          keywords: ['benefits','insurance','health','medical','dental','vision'],
          types: ['W2_Contingent'],
          answer: "W-2 Contingent Benefits\n\n**Benefits provider:** [BENEFITS_PROVIDER]\n\n**Health Insurance:**\n‚Ä¢ Medical: [MEDICAL_PLAN]\n‚Ä¢ Dental and Vision included\n‚Ä¢ [ENROLLMENT_WINDOW]\n\n**Retirement:**\n‚Ä¢ 401(k) with [MATCH_401K]\n\n**Time Off:**\n‚Ä¢ [PTO_DAYS]\n\n**How to enroll:**\nUse **[PORTAL]** or contact your benefits team."
        },
        {
          id: 'emp_pto_w2',
          keywords: ['pto','vacation','time off','request time off','take time off'],
          types: ['W2_Contingent'],
          answer: "PTO for W-2 Contingent\n\n**PTO managed by:** [PTO_PROVIDER]\n\n**Your PTO:**\n‚Ä¢ [PTO_DAYS]\n‚Ä¢ Vacation: request ~2+ weeks in advance\n‚Ä¢ Sick time: same-day when needed\n\n**How to request:**\nSubmit in **[PORTAL]**. Your client manager handles scheduling; **[PTO_PROVIDER]** confirms eligibility/balance."
        },
        {
          id: 'emp_payroll_w2',
          keywords: ['pay','paycheck','paid','salary','wage','when do i get paid','payday'],
          types: ['W2_Contingent'],
          answer: "W-2 Contingent Payroll\n\n**Who pays you:** **[PAYROLL_PROVIDER]** (see your paystub)\n\n**Pay schedule:**\n‚Ä¢ [PAYROLL_SCHEDULE]\n‚Ä¢ Direct deposit supported\n‚Ä¢ Taxes withheld automatically\n\n**Paystubs:**\nView anytime in **[PORTAL]**."
        },
        {
          id: 'emp_time_w2',
          keywords: ['timesheet','time','log time','track time','clock in','log hours','enter time'],
          types: ['W2_Contingent'],
          answer: "Time Tracking (W-2 Contingent)\n\n**Where to log time:** [TIME_SYSTEM]\n\n**How it works:**\n‚Ä¢ Clock in/out or add hours in the portal\n‚Ä¢ Submit weekly (e.g., Friday 5pm)\n‚Ä¢ Manager approves\n\n**Access help:**\n[ACCESS_HELP]"
        },
        {
          id: 'emp_benefits_1099',
          keywords: ['benefits','insurance','health','medical','dental','vision'],
          types: ['1099'],
          answer: "1099 Contractor ‚Äî Benefits & Coverage\n\nAs an independent contractor, you typically arrange your own coverage and retirement.\n\n**What clients usually don't provide:**\n‚Ä¢ Health insurance\n‚Ä¢ 401(k) matching\n‚Ä¢ Paid time off\n\n**Your options:**\n‚Ä¢ Healthcare.gov or private plans\n‚Ä¢ Solo 401(k) or SEP-IRA\n‚Ä¢ Disability insurance\n‚Ä¢ Consider pricing your rate to cover time off and benefits\n\nIf you're unsure about your status, check January tax forms (1099 vs W-2) or your payment method (invoice vs paycheck)."
        },
        {
          id: 'emp_pto_1099',
          keywords: ['pto','vacation','time off'],
          types: ['1099'],
          answer: "1099 Time Off\n\nIndependent contractors usually take unpaid time off.\n\n**Good practices:**\n‚Ä¢ Give your client notice (ideally 2+ weeks)\n‚Ä¢ Align on deliverables/timelines\n‚Ä¢ Don't bill for days off\n‚Ä¢ Build time-off buffers into your rate"
        },
        {
          id: 'emp_time_1099',
          keywords: ['timesheet','time','log time','track time','log hours','enter time'],
          types: ['1099'],
          answer: "1099 Time Tracking\n\nYou can track time in a way that fits your business.\n\n**Common approaches:**\n‚Ä¢ Spreadsheet or apps (Toggl, Harvest)\n‚Ä¢ Track for invoices and tax records\n‚Ä¢ Client may request a system for visibility‚Äîyour invoice remains authoritative"
        },
        {
          id: 'emp_payment_1099',
          keywords: ['invoice','bill','payment','get paid','invoicing'],
          types: ['1099'],
          answer: "1099 Payments\n\n**Typical flow:**\n‚Ä¢ Submit invoices to your client (per milestone or cadence)\n‚Ä¢ Common terms: Net 30\n‚Ä¢ No tax withholding‚Äîplan for quarterly taxes if applicable\n\n**Invoice includes:**\n‚Ä¢ Business name, services, units/hours, rate, total, terms\n\n**Tip:** Many contractors set aside ~25‚Äì30% for taxes (confirm with a tax pro)."
        },
        {
          id: 'emp_who_1099',
          keywords: ['eor','employer of record','staffing','agency','who is my employer'],
          types: ['1099'],
          answer: "1099 Status Overview\n\nIndependent contractors are self-employed. Your client is not your employer; you provide services under a contract and invoice for payment.\n\nIf you're unsure whether you're 1099 or W-2, check whether you receive paystubs with tax withholdings (W-2) or issue invoices (1099)."
        }
      ],
      manager: [
        {
          id: 'mgr_pto',
          keywords: ['pto','time off','team pto','approve pto','vacation'],
          types: ['All'],
          answer: "Team PTO for [EMPLOYEE_NAME]\n\n**Worker Type:** [WORKER_TYPE]\n\n[PTO_DETAILS]\n\n**Your role:**\n[MANAGER_ROLE]"
        },
        {
          id: 'mgr_engagement',
          keywords: ['engagement','team engagement','engage','morale','motivation','appreciate','appreciation','feeling valued'],
          types: ['All'],
          answer: "Building Team Engagement & Appreciation\n\n**Why it matters for contingent workers:**\nContingent team members often feel \"outside\" the core team. Intentional inclusion drives better performance, retention, and referrals.\n\n**Quick Wins (Do These First):**\n‚Ä¢ **Welcome them properly** - Intro to team, tour, buddy system, team lunch first week\n‚Ä¢ **Include in team rituals** - All-hands, team celebrations, Slack channels, social events\n‚Ä¢ **Public recognition** - Shout-outs in meetings, Slack kudos, highlight their wins\n‚Ä¢ **Use their name** - Not \"the contractor\" or \"the temp\" - always use their actual name\n\n**Ongoing Practices:**\n‚Ä¢ **Regular 1:1s** - Weekly or bi-weekly, same as permanent staff\n‚Ä¢ **Career conversations** - Ask about their goals, offer stretch projects, connect them to learning\n‚Ä¢ **Visibility to leadership** - Include them in demos, let them present their work\n‚Ä¢ **Feedback loops** - Ask \"How can I better support you?\" and actually act on it\n‚Ä¢ **Project ownership** - Give real responsibility, not just tasks\n\n**Recognition Ideas:**\n‚Ä¢ Celebrate project completions publicly\n‚Ä¢ Send thank-you messages copying their EOR recruiter\n‚Ä¢ Nominate for company awards (if eligible)\n‚Ä¢ LinkedIn recommendations when they move on\n‚Ä¢ Ask for their input in planning/strategy\n\n**What NOT to do:**\n‚ùå Exclude them from team events (\"it's just for full-time staff\")\n‚ùå Treat them as interchangeable resources\n‚ùå Only give feedback when something's wrong\n‚ùå Promise employment/promotion you can't deliver\n‚ùå Make jokes about their \"temporary\" status\n\n**Remember:** Contingent doesn't mean disposable. These are professionals who chose flexibility - treat them like the valuable team members they are."
        },
        {
          id: 'mgr_benefits',
          keywords: ['benefits','insurance','team benefits','health insurance'],
          types: ['All'],
          answer: "Team Benefits for [EMPLOYEE_NAME]\n\n**Worker Type:** [WORKER_TYPE]\n\n[BENEFITS_DETAILS]\n\n**Your role as manager:**\n[BENEFITS_CONTACT]"
        },
        {
          id: 'mgr_payroll',
          keywords: ['payroll','paycheck','pay issue','salary'],
          types: ['All'],
          answer: "Team Payroll Questions\n\n**For W-2 Contingent:** Payroll for [EMPLOYEE_NAME] is handled by [EOR]. You can approve hours; payroll questions should route to the EOR payroll team.\n\n**For 1099:** Contractors submit invoices to Accounts Payable per agreed terms."
        },
        {
          id: 'mgr_feedback',
          keywords: ['feedback','give feedback','providing feedback','how to give feedback'],
          types: ['All'],
          answer: "Giving Effective Feedback\n\n**Positive Feedback (Recognition):**\n‚Ä¢ Be specific: \"Your proposal included clear ROI analysis\"\n‚Ä¢ State impact: \"This helped leadership make a faster decision\"\n‚Ä¢ Timely: Within 24-48 hours of the achievement\n‚Ä¢ Public when possible: \"I'd like to give a shoutout to [EMPLOYEE_NAME] for showing up everyday and making such a positive impact on our community!\"\n\n**Constructive Feedback (Growth):**\n‚Ä¢ Private setting, timely conversation\n‚Ä¢ SBI Model:\n  - **Situation:** \"In yesterday's client meeting...\"\n  - **Behavior:** \"...when you interrupted the client twice...\"\n  - **Impact:** \"...they seemed frustrated and we lost momentum\"\n‚Ä¢ Focus on actions, not character\n‚Ä¢ Ask: \"What's your perspective?\" (listen actively)\n‚Ä¢ Collaborate: \"What could work better next time?\"\n‚Ä¢ End with support: \"I'm here to help you succeed\"\n\n**General principles:**\n‚Ä¢ Balance: Aim for 3-5 positive interactions per constructive one\n‚Ä¢ Regular rhythm: Don't save it all for reviews\n‚Ä¢ Follow up: Check in on progress\n‚Ä¢ Document: Keep notes for performance conversations"
        },
        {
          id: 'mgr_productivity',
          keywords: ['productivity','productive','efficiency','get more done','time management'],
          types: ['All'],
          answer: "Productivity Tips for Managers\n\n**Personal:**\n‚Ä¢ Block deep work\n‚Ä¢ Batch similar tasks\n‚Ä¢ Quiet hours for focus\n\n**Team:**\n‚Ä¢ 3 priorities/week\n‚Ä¢ Short async updates vs status meetings\n‚Ä¢ Celebrate visible wins"
        },
        {
          id: 'mgr_prioritization',
          keywords: ['prioritize','priorities','prioritization','what to focus on','too much work'],
          types: ['All'],
          answer: "Prioritization Framework (2√ó2)\n‚Ä¢ Urgent+Important = Do now\n‚Ä¢ Important+Not urgent = Schedule\n‚Ä¢ Urgent+Not important = Delegate\n‚Ä¢ Neither = Remove\n\nTeam ritual: Set top 3 weekly ‚Üí midweek check ‚Üí Friday review."
        },
        {
          id: 'mgr_delegation',
          keywords: ['delegate','delegation','delegating','empower','give work'],
          types: ['All'],
          answer: "Delegation Guide\n\n**Delegate:** repeatable ops, growth tasks\n**Keep:** reviews, sensitive HR, strategy, 1:1s\n**How:** outcome first, context/why, check-ins, then avoid over-directing once expectations are clear."
        },
        {
          id: 'mgr_communication',
          keywords: ['communication','communicate','clear communication','messaging'],
          types: ['All'],
          answer: "Clear Communication (3Cs)\n‚Ä¢ **Clear:** what exactly\n‚Ä¢ **Concise:** keep it tight\n‚Ä¢ **Context:** why it matters\n\nChannel fit: Slack ‚Üî quick; Email ‚Üî decisions; Meeting ‚Üî discussion."
        },
        {
          id: 'mgr_meetings',
          keywords: ['meetings','too many meetings','meeting overload','run meetings','facilitate'],
          types: ['All'],
          answer: "Meeting Management\n\nBefore: could this be async?\nDuring: start on time, agenda, owner, notes & owners by when.\nAfter: send action items."
        },
        {
          id: 'mgr_goals',
          keywords: ['goals','goal setting','objectives','okr','targets','kpi'],
          types: ['All'],
          answer: "Goal Setting\n\nPick 1‚Äì3 weekly, make them SMART, assign owner & deadline. Post Monday ‚Üí check Wednesday ‚Üí celebrate Friday."
        },
        {
          id: 'mgr_difficult',
          keywords: ['difficult conversation','tough conversation','confrontation','uncomfortable','sensitive topic'],
          types: ['All'],
          answer: "Difficult Conversations\n\nOpen with facts, explain impact, listen, agree on what changes by when, document, follow up."
        },
        {
          id: 'mgr_trust',
          keywords: ['trust','build trust','team trust','psychological safety'],
          types: ['All'],
          answer: "Building Team Trust\n\nAdmit what you don't know, keep commitments, give credit publicly, address blockers quickly."
        },
        {
          id: 'mgr_remote',
          keywords: ['remote','remote team','hybrid','distributed','virtual team','work from home'],
          types: ['All'],
          answer: "Managing Remote Teams\n\nDocument decisions, default to async, rotate times, record/share notes, focus on outputs not hours."
        },
        {
          id: 'mgr_conflict',
          keywords: ['conflict','conflict resolution','team conflict','disagreement','argument','tension'],
          types: ['All'],
          answer: "Resolving Team Conflict\n\nUnderstand both sides, bring together with ground rules, find shared goals, co-create solution, follow up."
        },
        {
          id: 'mgr_new_manager',
          keywords: ['new manager','first time manager','new to management','just promoted','manager advice'],
          types: ['All'],
          answer: "New Manager Basics\n\nFirst 30 days: listen, learn, set 1:1s, find a mentor, don't change everything at once. Your job is enabling output and growth."
        },
        {
          id: 'mgr_performance',
          keywords: ['performance','performance management','underperformance','low performance','not delivering'],
          types: ['All'],
          answer: "Managing Performance\n\nAddress early, be specific, agree on 2-week plan, check in twice weekly, document, involve HR if not improving. For W-2 contingent, loop in [EMPLOYEE_NAME]'s EOR ([EOR]) early."
        },
        {
          id: 'mgr_recognition',
          keywords: ['recognition','recognize','praise','appreciate','thank','kudos'],
          types: ['All'],
          answer: "Recognition That Sticks\n\nSay what they did + impact + why it matters. Praise publicly; coach privately."
        },
        {
          id: 'mgr_coaching',
          keywords: ['coaching','coach','develop','development','grow','career growth'],
          types: ['All'],
          answer: "Coaching\n\nUse questions: options, blockers, success definition, supports. Offer stretch work, shadowing, presenting."
        },
        {
          id: 'mgr_manage_contingent',
          keywords: ['manage','managing','contingent','contractor','team'],
          types: ['All'],
          answer: "Managing Contingent Workers\n\nDirect daily work/deliverables. Avoid pay/benefits discussions or employment promises. Route HR items to [EMPLOYEE_NAME]'s EOR: [EOR]."
        },
        {
          id: 'mgr_time_tracking',
          keywords: ['timesheet','time tracking','log time','clock in'],
          types: ['All'],
          answer: "Team Time Tracking\n\n**For W-2 contingent:** [EMPLOYEE_NAME] logs time in [EOR]'s system; you approve.\n\n**For 1099:** Contractors track their own time; you verify deliverables."
        },
        {
          id: 'mgr_invoices',
          keywords: ['invoice','invoicing','contractor payment','1099 payment'],
          types: ['All'],
          answer: "Managing 1099 Payments\n\nContractor invoices ‚Üí Accounts Payable per terms. You approve accuracy vs deliverables; AP handles payment."
        },
        {
          id: 'mgr_1on1',
          keywords: ['1:1','one on one','check in','meeting'],
          types: ['All'],
          answer: "Effective 1:1s\n\nAgenda: wins, top 3, blockers, support, recognition. Capture actions & dates."
        },
        {
          id: 'mgr_1099_basics',
          keywords: ['contractor','1099','freelancer'],
          types: ['All'],
          answer: "Working with 1099 Contractors\n\nFocus on scope, deliverables, deadlines. Don't set hours or methods; route payment questions to AP."
        }
      ]
    };

    // ---------- Init ----------
    function init() {
      faqData = demoData;
      startOnboarding();
    }

    function startOnboarding() {
      if (currentMode === 'employee') {
        addBotMessage(
          "Hi! üëã I'm Aunikah, your work assistant.\n\nLet's start with a quick question: **What's your work classification?**"
        );
        setTimeout(() => {
          addSetupButtons([
            { label: 'üìã W-2 Contingent Worker', action: () => setEmploymentType('W2_Contingent') },
            { label: 'üíº 1099 Independent Contractor', action: () => setEmploymentType('1099') },
            { label: 'ü§î I\'m not sure - help me figure it out', action: () => startClassificationHelper() }
          ]);
        }, 500);
      } else {
        addBotMessage(
          "Hi! üëî I'm Aunikah, your manager assistant.\n\n**Which team member do you need help with?**"
        );
        setTimeout(() => {
          const employeeButtons = Object.keys(employeeDatabase).map(name => ({
            label: name,
            action: () => selectEmployee(name)
          }));
          addSetupButtons(employeeButtons);
        }, 500);
      }
    }

    // ---------- Classification Helper ----------
    function startClassificationHelper() {
      addUserMessage("I'm not sure - help me figure it out");
      
      setTimeout(() => {
        addBotMessage(
          "No problem! Let's figure this out together. üîç\n\n**First question: How do you get paid?**"
        );
        setTimeout(() => {
          addSetupButtons([
            { label: 'üí∞ I receive a paycheck/paystub', action: () => classificationStep2Paycheck() },
            { label: 'üìÑ I send invoices and get paid for them', action: () => classificationFound1099() }
          ]);
        }, 300);
      }, 500);
    }

    function classificationStep2Paycheck() {
      addUserMessage("I receive a paycheck/paystub");
      
      setTimeout(() => {
        addBotMessage(
          "Great! üìã That means you're W-2.\n\n**Next: Look at your paystub. Is the company name on it different from where you actually work?**\n\nFor example:\n‚Ä¢ Paystub says \"Employee Stand\" but you work at \"UnBungle\"\n‚Ä¢ Or paystub and workplace are the same company"
        );
        setTimeout(() => {
          addSetupButtons([
            { label: '‚úÖ Yes - different companies', action: () => classificationFoundW2Contingent() },
            { label: 'üìç No - same company', action: () => classificationFoundW2Perm() }
          ]);
        }, 300);
      }, 500);
    }

    function classificationFoundW2Contingent() {
      addUserMessage("Yes - the company on my paystub is different from where I work");
      
      setTimeout(() => {
        addBotMessage(
          "Perfect! ‚úÖ You're a **W-2 Contingent Worker**.\n\nThis means:\n‚Ä¢ The company on your paystub is your **Employer of Record (EOR)** or staffing agency\n‚Ä¢ The place where you work is your **client company**\n‚Ä¢ Your EOR handles pay, benefits, and taxes\n‚Ä¢ Your client company directs your daily work\n\nLet's continue with setup!"
        );
        setTimeout(() => {
          setEmploymentType('W2_Contingent');
        }, 1000);
      }, 500);
    }

    function classificationFoundW2Perm() {
      addUserMessage("No - same company on paystub and where I work");
      
      setTimeout(() => {
        addBotMessage(
          "Got it! You're a **W-2 Permanent Employee** of that company.\n\n‚ö†Ô∏è **Note:** Aunikah is designed for contingent workers (those placed through staffing agencies/EORs). For permanent employees, your HR team is your best resource for benefits, PTO, and payroll questions.\n\nWould you still like to continue? I can provide general guidance, but it might not match your specific situation."
        );
        setTimeout(() => {
          addSetupButtons([
            { label: 'üëç Continue anyway', action: () => setEmploymentType('W2_Contingent') },
            { label: 'üëã Exit - talk to my HR team', action: () => resetSetup() }
          ]);
        }, 300);
      }, 500);
    }

    function classificationFound1099() {
      addUserMessage("I send invoices and get paid for them");
      
      setTimeout(() => {
        addBotMessage(
          "Perfect! ‚úÖ You're a **1099 Independent Contractor**.\n\nThis means:\n‚Ä¢ You're self-employed\n‚Ä¢ You invoice for your work\n‚Ä¢ No taxes withheld (you handle quarterly taxes)\n‚Ä¢ You arrange your own benefits\n‚Ä¢ Time off is typically unpaid\n\nLet's continue with setup!"
        );
        setTimeout(() => {
          setEmploymentType('1099');
        }, 1000);
      }, 500);
    }

    // ---------- Setup Flow ----------
    function setEmploymentType(type) {
      detectedType = type;
      updateBadges();
      const typeLabel = type === 'W2_Contingent' ? 'W-2 Contingent Worker' : '1099 Independent Contractor';
      addUserMessage(`I'm a ${typeLabel}`);
      
      setTimeout(() => {
        addBotMessage(`Great! You're a **${typeLabel}**.\n\n**Where do you work?** (Your client company)`);
        setTimeout(() => {
          addSetupButtons([
            { label: 'UnBungle', action: () => setClientCompany('UnBungle') },
            { label: 'Micro Operators', action: () => setClientCompany('Micro Operators') },
            { label: 'Amazing Floors', action: () => setClientCompany('Amazing Floors') },
            { label: 'Metadata TechCo', action: () => setClientCompany('Metadata TechCo') }
          ]);
        }, 300);
      }, 500);
    }

    function setClientCompany(company) {
      clientCompany = company;
      updateBadges();
      addUserMessage(`I work at ${company}`);
      
      if (detectedType === '1099') {
        setTimeout(() => {
          addBotMessage(
            `Perfect! ‚úÖ You're all set up:\n‚Ä¢ **Type:** 1099 Independent Contractor\n‚Ä¢ **Client:** ${company}\n\nNow, how can I help you today?`
          );
          setTimeout(() => {
            addSuggestionButtons([
              "What are my benefits?",
              "How do I handle time off?",
              "When do I get paid?",
              "How do I invoice?"
            ]);
            setupComplete = true;
          }, 300);
        }, 500);
      } else {
        setTimeout(() => {
          addBotMessage(`Got it! Now, **who employs you?** (The company on your paystub - your EOR/staffing agency)`);
          setTimeout(() => {
            addSetupButtons([
              { label: 'Employee Stand', action: () => setEmployerCompany('Employee Stand') },
              { label: 'ADevco', action: () => setEmployerCompany('ADevco') },
              { label: 'People Power', action: () => setEmployerCompany('People Power') },
              { label: 'People Lite', action: () => setEmployerCompany('People Lite') }
            ]);
          }, 300);
        }, 500);
      }
    }

    function setEmployerCompany(company) {
      employerCompany = company;
      updateBadges();
      addUserMessage(`I'm employed by ${company}`);
      
      setTimeout(() => {
        addBotMessage(
          `Perfect! ‚úÖ You're all set up:\n‚Ä¢ **Type:** W-2 Contingent Worker\n‚Ä¢ **Client:** ${clientCompany}\n‚Ä¢ **Employer (EOR):** ${company}\n\nNow, how can I help you today?`
        );
        setTimeout(() => {
          addSuggestionButtons([
            "What are my benefits?",
            "How do I request PTO?",
            "When do I get paid?",
            "Who is my employer?"
          ]);
          setupComplete = true;
        }, 300);
      }, 500);
    }

    function selectEmployee(name) {
      selectedEmployee = name;
      const empData = employeeDatabase[name];
      detectedType = empData.type;
      clientCompany = empData.client;
      employerCompany = empData.employer;
      updateBadges();
      
      addUserMessage(name);
      
      setTimeout(() => {
        const typeLabel = empData.type === 'W2_Contingent' ? 'W-2 Contingent' : '1099 Contractor';
        let message = `Got it! Here's **${name}**'s info:\n‚Ä¢ **Type:** ${typeLabel}\n‚Ä¢ **Client:** ${empData.client}`;
        if (empData.employer) {
          message += `\n‚Ä¢ **Employer (EOR):** ${empData.employer}`;
        }
        message += '\n\nHow can I help you support them?';
        addBotMessage(message);
        
        setTimeout(() => {
          addSuggestionButtons([
            "How to give feedback?",
            `${name}'s PTO questions`,
            `${name}'s benefits questions`,
            "Team engagement tips?"
          ]);
          setupComplete = true;
        }, 300);
      }, 500);
    }

    function resetSetup() {
      detectedType = null;
      clientCompany = null;
      employerCompany = null;
      selectedEmployee = null;
      setupComplete = false;
      updateBadges();
      document.getElementById('chatMessages').innerHTML = '';
      startOnboarding();
    }

    // ---------- UI Helpers ----------
    function updateBadges() {
      const detBadge = document.getElementById('detectionBadge');
      const clientBadge = document.getElementById('clientBadge');
      const emplBadge = document.getElementById('employerBadge');
      
      if (currentMode === 'manager' && selectedEmployee) {
        detBadge.innerHTML = `<span class="badge badge-detection">Helping with: ${selectedEmployee}</span>`;
      } else if (currentMode === 'employee' && detectedType) {
        detBadge.innerHTML = `<span class="badge badge-detection">${detectedType === 'W2_Contingent' ? 'W-2 Contingent' : detectedType}</span>`;
      } else {
        detBadge.innerHTML = '';
      }
      
      clientBadge.innerHTML = clientCompany ? `<span class="badge badge-client">@ ${clientCompany}</span>` : '';
      
      // Only show employer badge for W-2 workers
      if (detectedType === '1099') {
        emplBadge.innerHTML = '<span class="badge badge-employer">Self-employed</span>';
      } else if (employerCompany) {
        emplBadge.innerHTML = `<span class="badge badge-employer">Employed by: ${employerCompany}</span>`;
      } else {
        emplBadge.innerHTML = '';
      }
    }

    function switchMode(mode, event) {
      currentMode = mode;
      document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      const desc = document.getElementById('modeDescription');
      desc.childNodes[0].textContent = mode === 'employee' 
        ? 'Your Work Assistant' 
        : 'Manager Coaching & Team Support';
      
      resetSetup();
    }

    function addBotMessage(text) {
      const messages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'message bot';
      div.innerHTML = `
        <div class="message-avatar">A</div>
        <div class="message-content">${parseMarkdown(text)}</div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    function addUserMessage(text) {
      const messages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'message user';
      div.innerHTML = `
        <div class="message-avatar">You</div>
        <div class="message-content">${text}</div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    function addSetupButtons(buttons) {
      const messages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'message bot';
      const buttonsHtml = buttons.map(btn => 
        `<button class="setup-btn">${btn.label}</button>`
      ).join('');
      div.innerHTML = `
        <div class="message-avatar">A</div>
        <div class="message-content">
          <div style="display:flex;flex-direction:column;gap:8px;">
            ${buttonsHtml}
          </div>
        </div>`;
      messages.appendChild(div);
      
      // Attach click handlers
      const buttonElements = div.querySelectorAll('.setup-btn');
      buttonElements.forEach((btn, index) => {
        btn.onclick = buttons[index].action;
      });
      
      messages.scrollTop = messages.scrollHeight;
    }

    function addSuggestionButtons(suggestions) {
      const messages = document.getElementById('chatMessages');
      const lastMessage = messages.lastElementChild;
      if (lastMessage && lastMessage.classList.contains('bot')) {
        const content = lastMessage.querySelector('.message-content');
        const suggestionsDiv = document.createElement('div');
        suggestionsDiv.className = 'suggestions';
        suggestionsDiv.innerHTML = suggestions.map(s => 
          `<button class="suggestion-btn">${s}</button>`
        ).join('');
        content.appendChild(suggestionsDiv);
        
        const buttons = suggestionsDiv.querySelectorAll('.suggestion-btn');
        buttons.forEach((btn, index) => {
          btn.onclick = () => handleSuggestionClick(suggestions[index]);
        });
      }
      messages.scrollTop = messages.scrollHeight;
    }

    function handleSuggestionClick(text) {
      addUserMessage(text);
      const input = document.getElementById('chatInput');
      input.value = '';
      showTypingIndicator();
      setTimeout(() => {
        hideTypingIndicator();
        const response = getResponse(text);
        if (typeof response === 'string') {
          addBotMessage(wrapTone(response, text));
        } else {
          addBotMessage(wrapTone(response.response, text));
          setTimeout(() => addSuggestionButtons(response.suggestions), 300);
        }
      }, 900);
    }

    function showTypingIndicator() {
      const messages = document.getElementById('chatMessages');
      const typing = document.createElement('div');
      typing.className = 'message bot';
      typing.id = 'typingIndicator';
      typing.innerHTML = `
        <div class="message-avatar">A</div>
        <div class="typing-indicator active">
          <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
        </div>`;
      messages.appendChild(typing);
      messages.scrollTop = messages.scrollHeight;
    }

    function hideTypingIndicator() {
      const typing = document.getElementById('typingIndicator');
      if (typing) typing.remove();
    }

    // ---------- Matching ----------
    function normalizeText(text) {
      let normalized = text.toLowerCase();
      Object.keys(typos).forEach(typo => {
        normalized = normalized.replace(new RegExp('\\b' + typo + '\\b', 'gi'), typos[typo]);
      });
      return normalized;
    }

    function findMatch(msg) {
      const faqs = faqData[currentMode] || [];
      const normalized = normalizeText(msg);
      let bestMatch = null;
      let bestScore = 0;

      const filteredFaqs = faqs.filter(faq => {
        if (currentMode === 'employee' && detectedType) {
          return faq.types.includes(detectedType) || faq.types.includes('All');
        }
        return true;
      });

      filteredFaqs.forEach(faq => {
        faq.keywords.forEach(kw => {
          if (normalized.includes(kw.toLowerCase())) {
            const score = 0.95;
            if (score > bestScore) {
              bestScore = score;
              bestMatch = faq;
            }
          }
        });
      });
      return { faq: bestMatch, confidence: bestScore };
    }

    // ---------- Response generation ----------
    function getResponse(msg) {
      if (!setupComplete) {
        return "Let's finish your setup first! Please click one of the buttons above.";
      }

      const lower = normalizeText(msg);

      // Greetings
      if (lower.match(/\b(hi|hello|hey)\b/)) {
        return currentMode === 'employee'
          ? "Hello! üòä How can I help you today?"
          : "Hello! üëî How can I help you support your team?";
      }

      // Thanks
      if (lower.match(/\b(thank|thanks)\b/)) return "You're welcome! üåü";

      // Attempt match
      const match = findMatch(msg);
      if (match.faq && match.confidence > 0.6) {
        let response = match.faq.answer;

        // Personalization
        if (currentMode === 'manager') {
          const workerTypeLabel = detectedType === 'W2_Contingent' ? 'W-2 Contingent Worker' : 
                                  detectedType === '1099' ? '1099 Independent Contractor' : 'Unknown';
          
          let benefitsDetails = '';
          let benefitsContact = '';
          let ptoDetails = '';
          let managerRole = '';
          
          if (detectedType === 'W2_Contingent') {
            benefitsDetails = `${selectedEmployee || 'This team member'} receives benefits through their employer of record, **${employerCompany || 'their EOR'}**.\n\n**Typical benefits include:**\n‚Ä¢ Health, dental, vision insurance\n‚Ä¢ 401(k) with employer match\n‚Ä¢ Paid time off (PTO)\n‚Ä¢ Workers' compensation coverage`;
            benefitsContact = `You can answer general questions, but benefits enrollment and specific plan details should route to ${employerCompany || 'their EOR'}'s benefits team.`;
            
            ptoDetails = `${selectedEmployee || 'This team member'}'s PTO policy is set by **${employerCompany || 'their EOR'}**.\n\n**How it works:**\n‚Ä¢ PTO accrues according to the EOR's policy\n‚Ä¢ ${selectedEmployee || 'They'} submit PTO requests in the EOR portal\n‚Ä¢ The EOR tracks balance and approves eligibility\n‚Ä¢ Vacation typically requires 2+ weeks notice\n‚Ä¢ Sick time can be used same-day`;
            managerRole = `You approve scheduling and coverage to ensure work continuity. The EOR (${employerCompany || 'their employer'}) confirms eligibility and tracks the balance.`;
          } else if (detectedType === '1099') {
            benefitsDetails = `As a 1099 independent contractor, ${selectedEmployee || 'this team member'} is self-employed and typically arranges their own benefits.`;
            benefitsContact = `You can answer general questions, but 1099 independent contractors are self-employed and handle their own coverage.`;
            
            ptoDetails = `As a 1099 independent contractor, ${selectedEmployee || 'this team member'} does not receive paid time off.\n\n**How it works:**\n‚Ä¢ Time off is unpaid\n‚Ä¢ ${selectedEmployee || 'They'} should build time-off costs into their rate\n‚Ä¢ Best practice: Give 2+ weeks notice when possible\n‚Ä¢ Don't bill for days not worked`;
            managerRole = `Coordinate scheduling and align on deliverables/timelines. Ensure work commitments are met or coverage is arranged.`;
          }
          
          response = response.replace(/\[EOR\]/g, employerCompany || 'their EOR/staffing company')
            .replace(/\[Client Company\]/g, clientCompany || 'your company')
            .replace(/\[EMPLOYEE_NAME\]/g, selectedEmployee || 'your team member')
            .replace(/\[WORKER_TYPE\]/g, workerTypeLabel)
            .replace(/\[BENEFITS_DETAILS\]/g, benefitsDetails)
            .replace(/\[BENEFITS_CONTACT\]/g, benefitsContact)
            .replace(/\[PTO_DETAILS\]/g, ptoDetails)
            .replace(/\[MANAGER_ROLE\]/g, managerRole);
        } else {
          const client = clientCompany || 'your client company';
          const eor = employerCompany || 'your EOR/staffing company';

          if (detectedType === '1099') {
            response = response.replace(/\[EOR\]/g, "N/A (self-employed)")
              .replace(/\[Client Company\]/g, client);
          } else if (detectedType === 'W2_Contingent') {
            response = response.replace(/\[Client Company\]/g, client)
              .replace(/\[EOR\]/g, eor)
              .replace(/\[BENEFITS_PROVIDER\]/g, `${eor} (your employer)`)
              .replace(/\[PTO_PROVIDER\]/g, eor)
              .replace(/\[PAYROLL_PROVIDER\]/g, eor)
              .replace(/\[TIME_SYSTEM\]/g, `${eor}'s time system (may sync with ${client})`)
              .replace(/\[ACCESS_HELP\]/g, `For ${eor} portal/paystubs: contact ${eor} support. For ${client} systems: your manager or ${client} IT.`);
            
            // EOR specifics
            if (employerCompany && eorBenefits[employerCompany]) {
              const d = eorBenefits[employerCompany];
              response = response.replace(/\[MEDICAL_PLAN\]/g, d.medical)
                .replace(/\[PTO_DAYS\]/g, d.pto_days)
                .replace(/\[MATCH_401K\]/g, d.match_401k)
                .replace(/\[ENROLLMENT_WINDOW\]/g, d.enrollment_window)
                .replace(/\[PORTAL\]/g, d.portal)
                .replace(/\[PAYROLL_SCHEDULE\]/g, d.payroll_schedule);
            } else {
              response = response.replace(/\[MEDICAL_PLAN\]/g, 'varies by EOR')
                .replace(/\[PTO_DAYS\]/g, '10‚Äì20 vacation + 5‚Äì10 sick days/year')
                .replace(/\[MATCH_401K\]/g, '3‚Äì6% match')
                .replace(/\[ENROLLMENT_WINDOW\]/g, '30‚Äì60 days from hire')
                .replace(/\[PORTAL\]/g, `${eor} benefits portal`)
                .replace(/\[PAYROLL_SCHEDULE\]/g, 'bi-weekly or weekly');
            }
          }
        }

        // Add CARE blocks for key W-2 topics
        if (currentMode === 'employee' && detectedType === 'W2_Contingent') {
          if (['emp_benefits_w2', 'emp_pto_w2', 'emp_payroll_w2'].includes(match.faq.id)) {
            if (match.faq.id === 'emp_benefits_w2') {
              response += "\n\n" + careFormat({
                clarify: "Your employer of record (EOR) offers and administers your benefits.",
                action: "Review plan options and complete enrollment by the stated window.",
                route: `Benefits support via ${employerCompany || 'your EOR'} portal`,
                evidence: "Your paystub and EOR portal list plan and employer details."
              });
            }
            if (match.faq.id === 'emp_pto_w2') {
              response += "\n\n" + careFormat({
                clarify: "PTO policy comes from your EOR; your client manager approves scheduling/coverage.",
                action: "Submit the request in your EOR portal and align dates with your client manager.",
                route: `PTO policy & balance in ${employerCompany || 'EOR'} portal`,
                evidence: "See PTO accruals/requests in the portal; check approvals in email."
              });
            }
            if (match.faq.id === 'emp_payroll_w2') {
              response += "\n\n" + careFormat({
                clarify: "Your EOR runs payroll and withholds taxes.",
                action: "Verify your pay schedule and direct deposit details.",
                route: `Payroll support via ${employerCompany || 'your EOR'} portal`,
                evidence: "Your paystub shows the employer name and pay schedule."
              });
            }
          }
        }

        return response;
      }

      // Fallback
      const employeeSuggestions = ["What are my benefits?", "How do I request PTO?", "When do I get paid?", "Who is my employer?"];
      const managerSuggestions = ["Team engagement tips?", "How to delegate work?", "How to give feedback?", "Managing remote teams?"];
      return {
        response: "I didn't find a direct match. I can help with benefits, PTO, payroll, employer/EOR info, or manager topics.\n\nTry one of these questions:",
        suggestions: currentMode === 'employee' ? employeeSuggestions : managerSuggestions
      };
    }

    // ---------- Message handling ----------
    function parseMarkdown(text) {
      text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      text = text.replace(/\n/g, '<br>');
      text = text.replace(/^‚Ä¢ (.+)$/gm, '<div style="margin-left:20px">‚Ä¢ $1</div>');
      text = text.replace(/^([‚úÖ‚ùå]) (.+)$/gm, '<div style="margin:4px 0">$1 $2</div>');
      text = text.replace(/üîç (.+?):/g, '<strong style="color:#667eea">üîç $1:</strong>');
      text = text.replace(/üí° (.+?):/g, '<strong style="color:#f59e0b">üí° $1:</strong>');
      text = text.replace(/üìå (.+?):/g, '<strong style="color:#ef4444">üìå $1:</strong>');
      return text;
    }

    function handleKeyPress(e) {
      if (e.key === 'Enter') handleSend();
    }

    function handleSend() {
      const input = document.getElementById('chatInput');
      const msg = input.value.trim();
      if (!msg) return;
      
      addUserMessage(msg);
      input.value = '';
      showTypingIndicator();
      
      setTimeout(() => {
        hideTypingIndicator();
        const result = getResponse(msg);
        if (typeof result === 'string') {
          addBotMessage(wrapTone(result, msg));
        } else {
          addBotMessage(wrapTone(result.response, msg));
          setTimeout(() => addSuggestionButtons(result.suggestions), 300);
        }
      }, 900);
    }

    // Boot
    window.onload = init;
  </script>
</body>
</html>


