<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aunikah - Smart Employment Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 900px;
            height: calc(100vh - 40px);
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 0 auto;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bot-avatar {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .header-text h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .header-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-detection {
            background: rgba(255, 255, 255, 0.3);
        }

        .badge-client {
            background: rgba(66, 153, 225, 0.3);
        }

        .badge-employer {
            background: rgba(159, 122, 234, 0.3);
        }

        .mode-selector {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .demo-notice {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
        }

        .demo-notice strong {
            display: block;
            margin-bottom: 5px;
        }

        .quick-setup {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            color: #333;
            display: none;
        }

        .quick-setup.active {
            display: block;
        }

        .quick-setup h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .company-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .company-btn {
            padding: 6px 12px;
            background: #f0f4ff;
            border: 1px solid #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            color: #667eea;
            transition: all 0.2s;
        }

        .company-btn:hover {
            background: #667eea;
            color: white;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            font-size: 14px;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.user .message-avatar {
            background: #6c757d;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.6;
        }

        .message.bot .message-content {
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .message.bot .message-content strong {
            font-weight: 600;
            color: #667eea;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
        }

        .typing-indicator {
            display: none;
            padding: 15px;
            background: white;
            border-radius: 12px;
            width: fit-content;
        }

        .typing-indicator.active {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn, .csv-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            font-size: 14px;
        }

        .csv-btn {
            background: #f0f4ff;
            color: #667eea;
            padding: 8px 16px;
            font-size: 12px;
        }

        .send-btn:hover, .csv-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .suggestion-btn {
            padding: 8px 15px;
            background: #f0f4ff;
            border: 1px solid #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            color: #667eea;
            transition: all 0.2s;
            font-weight: 500;
        }

        .suggestion-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }

            .message-content {
                max-width: 85%;
            }

            .mode-selector {
                flex-direction: column;
                gap: 5px;
            }
        }

        .footer {
            text-align: center;
            padding: 15px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-top">
                <div class="header-info">
                    <div class="bot-avatar">A</div>
                    <div class="header-text">
                        <h1>Aunikah</h1>
                        <p id="modeDescription">
                            Smart Employment Assistant
                            <span id="detectionBadge"></span>
                            <span id="clientBadge"></span>
                            <span id="employerBadge"></span>
                        </p>
                    </div>
                </div>
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="switchMode('employee', event)">üë§ Employee</button>
                    <button class="mode-btn" onclick="switchMode('manager', event)">üëî Manager</button>
                </div>
            </div>

            <div class="demo-notice">
                <strong>üß† Smart Detection Active</strong>
                I'll detect your employment type from your questions, or use Quick Setup for instant demo!
                <button onclick="toggleQuickSetup()" style="background:rgba(255,255,255,0.3);border:none;color:white;padding:4px 12px;border-radius:12px;cursor:pointer;font-size:11px;margin-left:10px">Quick Setup</button>
                <div style="margin-top:8px;font-size:11px;opacity:0.9;">
                    ‚ö†Ô∏è <strong>Demo Only:</strong> All company names, benefits, and policies shown are fictional examples for demonstration purposes and do not reflect actual employer or client benefits.
                </div>
            </div>

            <div class="quick-setup" id="quickSetup">
                <h3>Quick Demo Setup</h3>
                <p style="font-size:11px;color:#666;margin-bottom:15px;font-style:italic">
                    ‚öôÔ∏è Demo only: In production, the system auto-detects employment type from assignment data
                </p>
                
                <div style="margin-bottom:15px">
                    <strong style="font-size:12px;color:#667eea">Employment Type</strong>
                    <div class="company-buttons" style="margin-top:5px">
                        <button class="company-btn" onclick="setEmploymentType('W2_Contingent')">W2 Contingent</button>
                        <button class="company-btn" onclick="setEmploymentType('1099')">1099 Contractor</button>
                    </div>
                </div>

                <div style="margin-bottom:10px">
                    <strong style="font-size:12px;color:#666">Where do you work? (Client)</strong>
                    <div class="company-buttons">
                        <button class="company-btn" onclick="setClient('Google')">Google</button>
                        <button class="company-btn" onclick="setClient('Microsoft')">Microsoft</button>
                        <button class="company-btn" onclick="setClient('Amazon')">Amazon</button>
                        <button class="company-btn" onclick="setClient('Meta')">Meta</button>
                    </div>
                </div>
                <div>
                    <strong style="font-size:12px;color:#666">Who employs you? (EOR/Staffing)</strong>
                    <p style="font-size:10px;color:#999;margin:2px 0 5px 0">‚ö†Ô∏è Only for W2 contingent workers (disabled for 1099)</p>
                    <div class="company-buttons">
                        <button class="company-btn" onclick="setEmployer('Randstad')">Randstad</button>
                        <button class="company-btn" onclick="setEmployer('Adecco')">Adecco</button>
                        <button class="company-btn" onclick="setEmployer('Manpower')">Manpower</button>
                        <button class="company-btn" onclick="setEmployer('Robert Half')">Robert Half</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages"></div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="handleSend()">Send</button>
            </div>
        </div>
    </div>

    <div class="footer">
        ¬© <span id="year"></span> Amy Bray. All rights reserved.
    </div>

    <script>
        // Set copyright year
        document.getElementById('year').textContent = new Date().getFullYear();
        // State
        let currentMode = 'employee';
        let clientCompany = null;
        let employerCompany = null;
        let detectedType = null;
        let faqData = null;

        // EOR-specific benefit details
        const eorBenefits = {
            'Randstad': {
                medical: 'Blue Cross Blue Shield PPO',
                pto_days: '15 vacation + 10 sick days',
                match_401k: '4% match (100% vested after 1 year)',
                enrollment_window: '30 days from hire or November open enrollment',
                portal: 'MyRandstad benefits portal',
                payroll_schedule: 'Bi-weekly (every other Friday)'
            },
            'Adecco': {
                medical: 'Aetna HMO or PPO options',
                pto_days: '10 vacation + 5 sick days (increases after 2 years)',
                match_401k: '3% match (50% vested immediately)',
                enrollment_window: '60 days from hire or during annual enrollment',
                portal: 'Adecco Associate Portal',
                payroll_schedule: 'Weekly (every Friday)'
            },
            'Manpower': {
                medical: 'United Healthcare Choice Plus',
                pto_days: '12 vacation + 8 sick days',
                match_401k: '5% match (vested immediately)',
                enrollment_window: '30 days from start date',
                portal: 'ManpowerGroup MyPath',
                payroll_schedule: 'Bi-weekly (Fridays)'
            },
            'Robert Half': {
                medical: 'Cigna Open Access Plus',
                pto_days: '20 vacation + 10 sick days',
                match_401k: '6% match (100% vested)',
                enrollment_window: '45 days from hire',
                portal: 'RH Connect Benefits Hub',
                payroll_schedule: 'Bi-weekly (Thursdays)'
            }
        };

        // Typos mapping
        const typos = {
            'benifits': 'benefits', 'benfits': 'benefits', 'bennefits': 'benefits',
            'vaccation': 'vacation', 'vacaton': 'vacation',
            'insurence': 'insurance', 'insuranse': 'insurance',
            'holliday': 'holiday', 'sallary': 'salary',
            'payed': 'paid', 'pade': 'paid',
            'timeoff': 'time off', 'sicke': 'sick'
        };

        // Detection patterns
        const patterns = {
            indicators_1099: ['invoice', 'invoicing', 'bill', 'quarterly taxes', 'my rate', 'freelance', 'deduct'],
            indicators_w2: ['paycheck', 'paystub', 'withholding', 'pto', 'benefits enrollment', 'clock in'],
            indicators_contingent: ['staffing', 'eor', 'placed at', 'assignment', 'my recruiter'],
            confusion: ['my manager at', 'my boss at', 'i work for'],
            clients: ['google', 'microsoft', 'amazon', 'meta', 'apple', 'netflix'],
            eors: ['randstad', 'adecco', 'manpower', 'aerotek', 'robert half', 'kelly']
        };

        // Demo FAQ data
        const demoData = {
            employee: [
                {
                    keywords: ['eor', 'employer of record', 'staffing', 'agency', 'who is my employer'],
                    types: ['W2_Contingent'],
                    answer: "üìã **Understanding Your W2 Contingent Employment:**\n\n**Who's Your Employer?**\nCheck your paystub - that company is your legal employer.\n\n**As a W2 Contingent Worker:**\n‚Ä¢ You work ON-SITE at [Client Company]\n‚Ä¢ But [EOR] is on your paystub (like Randstad, Adecco, Manpower)\n‚Ä¢ [EOR] = Your legal employer\n‚Ä¢ [Client Company] = Where you physically work\n\n**The Three Players:**\n‚Ä¢ **[EOR]** = Your legal employer (paystub, W-2, benefits)\n‚Ä¢ **[Client Company]** = Your work location\n‚Ä¢ **AuniConnect** = Coordination partner\n\n**Who Handles What:**\n‚Ä¢ Pay, benefits, PTO, taxes, W-2 ‚Üí [EOR]\n‚Ä¢ Daily work, tasks, projects ‚Üí Your supervisor at [Client Company]\n‚Ä¢ Assignment questions ‚Üí Your AuniConnect contact\n\n**Important:** Your AuniConnect contact is NOT your manager or employer!"
                },
                {
                    keywords: ['benefits', 'benifits', 'insurance', 'health', 'medical', 'dental', 'vision'],
                    types: ['W2_Contingent'],
                    answer: "W2 Contingent Benefits:\n\n**Your Benefits Come From:**\n[BENEFITS_PROVIDER]\n\n**Health Insurance:**\n‚Ä¢ Medical: [MEDICAL_PLAN]\n‚Ä¢ Dental and Vision included\n‚Ä¢ [ENROLLMENT_WINDOW]\n\n**Retirement:**\n‚Ä¢ 401(k) with [MATCH_401K]\n\n**Time Off:**\n‚Ä¢ [PTO_DAYS]\n\n**How to Enroll:**\nLog into [PORTAL] or contact [BENEFITS_PROVIDER]'s HR team at 1-800-XXX-XXXX."
                },
                {
                    keywords: ['pto', 'vacation', 'time off', 'request time off', 'take time off'],
                    types: ['W2_Contingent'],
                    answer: "PTO for W2 Contingent:\n\n**Your PTO is Managed By:**\n[PTO_PROVIDER]\n\n**Your PTO Allocation:**\n‚Ä¢ [PTO_DAYS]\n‚Ä¢ Request 2+ weeks in advance for vacation\n‚Ä¢ Sick days can be used same-day\n\n**How to Request:**\nSubmit PTO requests through [PORTAL] or contact your [PTO_PROVIDER] HR representative.\n\n**Important:** PTO policies are set by [PTO_PROVIDER], not [Client Company]."
                },
                {
                    keywords: ['pay', 'paycheck', 'paid', 'salary', 'wage', 'when do i get paid', 'payday'],
                    types: ['W2_Contingent'],
                    answer: "W2 Contingent Payroll:\n\n**Who Pays You:**\n[PAYROLL_PROVIDER] (check your paystub!)\n\n**Pay Schedule:**\n‚Ä¢ [PAYROLL_SCHEDULE]\n‚Ä¢ Direct deposit required\n‚Ä¢ Taxes automatically withheld\n\n**Pay Stub Access:**\nView pay stubs anytime in [PORTAL]\n\n**Questions About Pay:**\nContact [PAYROLL_PROVIDER]'s payroll department or check [PORTAL] for details."
                },
                {
                    keywords: ['timesheet', 'time', 'log time', 'track time', 'clock in', 'log hours', 'enter time'],
                    types: ['W2_Contingent'],
                    answer: "Time Tracking for W2 Contingent:\n\n**Where to Log Time:**\n[TIME_SYSTEM]\n\n**How It Works:**\n‚Ä¢ Clock in/out via portal or time clock\n‚Ä¢ Submit weekly (usually by Friday 5pm)\n‚Ä¢ Manager approves\n‚Ä¢ Late submissions = delayed paycheck!\n\n**Access Issues:**\n[ACCESS_HELP]"
                },
                {
                    keywords: ['benefits', 'benifits', 'insurance', 'health', 'medical', 'dental', 'vision'],
                    types: ['1099'],
                    answer: "1099 Contractor - No Benefits:\n\n**Reality Check:** As a 1099 contractor, [Client Company] provides ZERO benefits. You're self-employed.\n\n**What You DON'T Get:**\n‚ùå No company health insurance\n‚ùå No 401(k) matching\n‚ùå No paid time off\n‚ùå No unemployment benefits\n\n**Your Options:**\n‚Ä¢ Healthcare.gov for insurance\n‚Ä¢ Solo 401(k) or SEP IRA\n‚Ä¢ Private disability insurance\n‚Ä¢ Build 20-30% extra into your rate\n\n**Are you sure you're 1099?** If you get paychecks (not invoices), you might be W2!"
                },
                {
                    keywords: ['pto', 'vacation', 'time off'],
                    types: ['1099'],
                    answer: "1099 Contractor Time Off:\n\n**Reality:** ZERO paid time off. Every day off = no income.\n\n**How to Handle:**\n‚Ä¢ Notify [Client Company] 2+ weeks ahead\n‚Ä¢ Ensure deliverables are covered\n‚Ä¢ Don't invoice for days off\n‚Ä¢ Build time off buffer into your rate\n\n**Confused?** If you think you have PTO, check your January tax form - W-2 or 1099-NEC?"
                },
                {
                    keywords: ['timesheet', 'time', 'log time', 'track time', 'log hours', 'enter time'],
                    types: ['1099'],
                    answer: "1099 Time Tracking:\n\n**You're the Boss:** Track time however you want.\n\n**Recommended:**\n‚Ä¢ Use spreadsheet or time tracking app (Toggl, Harvest)\n‚Ä¢ Track for YOUR records and invoicing\n‚Ä¢ [Client Company] may have a system for their tracking, but YOUR invoice is official\n\n**What to Track:**\n‚Ä¢ Date, hours, task description\n‚Ä¢ For invoicing [Client Company]\n‚Ä¢ For tax records (prove your hours if audited)\n\n**No Overtime:** You're not an employee - no 1.5x pay!"
                },
                {
                    keywords: ['invoice', 'bill', 'payment', 'get paid', 'invoicing'],
                    types: ['1099'],
                    answer: "1099 Contractor Payment:\n\n**How to Get Paid:**\n‚Ä¢ Submit invoices to [Client Company] (bi-weekly or per milestone)\n‚Ä¢ Payment in 30 days typically\n‚Ä¢ NO tax withholding - you handle ALL taxes\n\n**Invoice Must Include:**\n‚Ä¢ Your business name/SSN/EIN\n‚Ä¢ Hours or deliverables\n‚Ä¢ Rate and total amount\n‚Ä¢ Payment terms (Net 30)\n\n**Important:**\n‚Ä¢ Set aside 25-30% for taxes\n‚Ä¢ Track ALL business expenses\n‚Ä¢ You'll get 1099-NEC from [Client Company] in January"
                },
                {
                    keywords: ['eor', 'employer of record', 'staffing', 'agency', 'who is my employer'],
                    types: ['1099'],
                    answer: "1099 Contractor - You Have NO Employer:\n\n**Reality Check:** You're self-employed! You don't have an employer.\n\n**Here's the Deal:**\n‚Ä¢ [Client Company] is your CLIENT, not your employer\n‚Ä¢ You're running your own business\n‚Ä¢ You invoice them for services\n‚Ä¢ You handle your own taxes, benefits, insurance\n‚Ä¢ No one is withholding taxes from your pay\n\n**Are you SURE you're 1099?**\n‚Ä¢ Check your January tax form (1099-NEC, not W-2)\n‚Ä¢ Do you invoice them or get a paycheck?\n‚Ä¢ Do you see tax withholdings on your pay?\n\nIf you're getting a W-2 from someone like Randstad, Adecco, or Manpower - you're W2 contingent, not 1099!"
                }
            ],
            manager: [
                {
                    keywords: ['pto', 'time off', 'team pto', 'approve pto', 'vacation'],
                    types: ['All'],
                    answer: "Answering Team PTO Questions:\n\n**For Direct Hire:**\n‚Ä¢ Check your company's HR policy\n‚Ä¢ You approve scheduling, HR tracks balance\n\n**For W2 Contingent:**\n‚Ä¢ Their PTO comes from [EOR], NOT your company\n‚Ä¢ Direct them to [EOR]'s HR team\n‚Ä¢ You approve scheduling, [EOR] owns the policy\n\n**For 1099:**\n‚Ä¢ They have ZERO paid time off\n‚Ä¢ All time off is unpaid\n\nKeep a list of your contingent workers' EOR contacts!"
                },
                {
                    keywords: ['benefits', 'insurance', 'team benefits', 'health insurance'],
                    types: ['All'],
                    answer: "Answering Team Benefits Questions:\n\n**Direct Hire:** Your company's HR\n**W2 Contingent:** Their [EOR]'s benefits team (NOT your company!)\n**1099:** No company benefits - they're self-employed\n\n**Common confusion:** Contingent workers think your company provides benefits. Direct them to their [EOR] (check their paystub!)."
                },
                {
                    keywords: ['payroll', 'paycheck', 'pay issue', 'salary'],
                    types: ['All'],
                    answer: "Answering Team Payroll Questions:\n\n**Direct Hire:** Your payroll department\n**W2 Contingent:** Their [EOR] handles payroll, NOT your company\n**1099:** They invoice your accounts payable\n\nYou CANNOT access contingent workers' pay info. Direct them to their [EOR]'s payroll team."
                },
                {
                    keywords: ['productivity', 'productive', 'efficiency', 'get more done', 'time management'],
                    types: ['All'],
                    answer: "Productivity Tips for Managers:\n\n**Your Personal Productivity:**\n‚Ä¢ Block calendar: Deep work (9-11am), Team time (11-12pm), Meetings (1-3pm), Admin (3-5pm)\n‚Ä¢ Batch similar tasks together\n‚Ä¢ Use 'No Meeting Wednesday' for focus time\n‚Ä¢ Turn off Slack notifications during focus blocks\n\n**Team Productivity:**\n‚Ä¢ Set clear weekly priorities (3 max)\n‚Ä¢ Daily 15-min standup to unblock issues\n‚Ä¢ Async updates instead of status meetings\n‚Ä¢ Celebrate wins to maintain momentum\n\n**Common Mistake:** Trying to be available 24/7. Your team needs focused work time too!"
                },
                {
                    keywords: ['prioritize', 'priorities', 'prioritization', 'what to focus on', 'too much work'],
                    types: ['All'],
                    answer: "Prioritization Framework:\n\n**The 2x2 Matrix:**\n‚Ä¢ Urgent + Important = Do NOW\n‚Ä¢ Important + Not Urgent = SCHEDULE it\n‚Ä¢ Urgent + Not Important = DELEGATE it\n‚Ä¢ Neither = DELETE it\n\n**For Your Team:**\n1. List everything\n2. Ask: What has the biggest impact?\n3. Pick TOP 3 for this week\n4. Say NO to everything else\n\n**Weekly Ritual:**\nMonday: Set top 3 priorities\nFriday: Review what shipped\n\n**Pro Tip:** If everything is urgent, nothing is. Help your team say no."
                },
                {
                    keywords: ['delegate', 'delegation', 'delegating', 'empower', 'give work'],
                    types: ['All'],
                    answer: "Delegation Guide:\n\n**What to Delegate:**\n‚úÖ Tasks others can do 70%+ as well\n‚úÖ Recurring operational work\n‚úÖ Tasks that develop skills\n‚úÖ Work you don't enjoy (if someone else does)\n\n**What NOT to Delegate:**\n‚ùå Performance reviews\n‚ùå Sensitive HR issues\n‚ùå Strategic planning\n‚ùå Your 1:1s\n\n**How to Delegate Well:**\n1. Pick the right person (skill + capacity)\n2. Explain the OUTCOME, not the method\n3. Provide context (why it matters)\n4. Agree on check-ins\n5. Give authority with responsibility\n6. Don't micromanage!\n\n**New Manager Trap:** Doing everything yourself because 'it's faster.' It's not scalable!"
                },
                {
                    keywords: ['communication', 'communicate', 'clear communication', 'messaging'],
                    types: ['All'],
                    answer: "Clear Communication Tips:\n\n**The 3 Cs:**\n‚Ä¢ **Clear:** What exactly needs to happen?\n‚Ä¢ **Concise:** No 5 paragraphs when 3 sentences work\n‚Ä¢ **Context:** Why does this matter?\n\n**Choose the Right Channel:**\n‚Ä¢ Slack: Quick questions, FYIs\n‚Ä¢ Email: Documentation, decisions\n‚Ä¢ Meeting: Discussion, decisions, brainstorming\n‚Ä¢ 1:1: Feedback, coaching, personal topics\n\n**For Big Announcements:**\n1. Tell them what you're going to tell them\n2. Tell them\n3. Tell them what you told them\n\n**Over-communicate changes:** Say it 7 times before people really hear it."
                },
                {
                    keywords: ['meetings', 'too many meetings', 'meeting overload', 'run meetings', 'facilitate'],
                    types: ['All'],
                    answer: "Meeting Management:\n\n**Before Scheduling:**\n‚Ä¢ Ask: Could this be an email?\n‚Ä¢ Default to 25 or 50 min (not 30/60)\n‚Ä¢ Invite only decision-makers\n\n**Every Meeting Needs:**\n‚Ä¢ Clear objective in the title\n‚Ä¢ Agenda sent 24hrs before\n‚Ä¢ One owner/facilitator\n‚Ä¢ Notes + action items after\n\n**During the Meeting:**\n‚Ä¢ Start on time (even if people are late)\n‚Ä¢ Park off-topic items\n‚Ä¢ End with: Who's doing what by when?\n\n**Types of Meetings:**\n‚Ä¢ Daily standup: 15 min max\n‚Ä¢ 1:1s: 30 min weekly\n‚Ä¢ Planning: 60-90 min monthly\n\n**Cancel bad meetings!** Your team will thank you."
                },
                {
                    keywords: ['goals', 'goal setting', 'objectives', 'okr', 'targets', 'kpi'],
                    types: ['All'],
                    answer: "Goal Setting Framework:\n\n**Weekly Team Goals:**\n‚Ä¢ Pick 1-3 goals MAX\n‚Ä¢ Make them SMART: Specific, Measurable, Achievable, Relevant, Time-bound\n‚Ä¢ Each goal has: Owner, Deadline, Success criteria\n\n**Example:**\n‚ùå Bad: 'Improve performance'\n‚úÖ Good: 'Reduce page load time to <2sec by Friday (Owner: Alex)'\n\n**Share Goals Visibly:**\n‚Ä¢ Monday: Post goals in team channel\n‚Ä¢ Wednesday: Quick status check\n‚Ä¢ Friday: Celebrate what shipped\n\n**Individual Goals:**\n‚Ä¢ Quarterly career development goals\n‚Ä¢ Monthly skill-building targets\n‚Ä¢ Weekly output goals\n\n**Track 3 Metrics:** Throughput, Quality, Velocity"
                },
                {
                    keywords: ['difficult conversation', 'tough conversation', 'hard feedback', 'confrontation', 'uncomfortable'],
                    types: ['All'],
                    answer: "Handling Difficult Conversations:\n\n**Prepare:**\n‚Ä¢ What outcome do you want?\n‚Ä¢ What are the facts? (not assumptions)\n‚Ä¢ Practice your opening line\n‚Ä¢ Pick the right time and place (private!)\n\n**During:**\n‚Ä¢ Start direct: 'I need to talk about [X]'\n‚Ä¢ State the facts: 'I noticed [behavior]'\n‚Ä¢ Explain impact: 'This affects [team/project]'\n‚Ä¢ Listen MORE than you talk (60/40 rule)\n‚Ä¢ Ask: 'What's going on from your side?'\n‚Ä¢ End with: 'Here's what needs to change by when'\n\n**Don't:**\n‚ùå Use 'compliment sandwiches' (they dilute message)\n‚ùå Apologize for giving feedback\n‚ùå Email difficult feedback (always face-to-face)\n\n**Follow Up:**\n‚Ä¢ Document the conversation\n‚Ä¢ Check in within a week\n‚Ä¢ Loop in HR if needed"
                },
                {
                    keywords: ['trust', 'build trust', 'team trust', 'psychological safety'],
                    types: ['All'],
                    answer: "Building Team Trust:\n\n**Do This:**\n‚úÖ Admit when you don't know\n‚úÖ Share your mistakes openly\n‚úÖ Ask for feedback and ACT on it\n‚úÖ Keep commitments (if you say it, do it)\n‚úÖ Give credit publicly\n‚úÖ Take blame privately\n\n**Weekly Trust Builders:**\n‚Ä¢ Share a personal story in team meeting\n‚Ä¢ Ask 'What's blocking you?' and REMOVE it\n‚Ä¢ Say 'I was wrong about [X]'\n‚Ä¢ Celebrate someone else's idea\n\n**Kill Trust:**\n‚ùå Taking credit for their work\n‚ùå Changing priorities without explanation\n‚ùå Playing favorites\n‚ùå Not defending them to upper management\n\n**Trust takes months to build, seconds to break.**"
                },
                {
                    keywords: ['remote', 'remote team', 'hybrid', 'distributed', 'virtual team', 'work from home'],
                    types: ['All'],
                    answer: "Managing Remote/Hybrid Teams:\n\n**Communication:**\n‚Ä¢ Over-communicate: What's obvious to you isn't to them\n‚Ä¢ Document everything (decisions, context, why)\n‚Ä¢ Default to async updates\n‚Ä¢ Video on for 1:1s and team meetings\n\n**Inclusion:**\n‚Ä¢ Rotate meeting times for different time zones\n‚Ä¢ Call on remote folks FIRST\n‚Ä¢ Share recordings and notes within 24hrs\n‚Ä¢ Don't make decisions in hallway conversations\n\n**Connection:**\n‚Ä¢ Virtual coffee chats (optional, casual)\n‚Ä¢ Slack channels for non-work chat\n‚Ä¢ Quarterly in-person meetups if possible\n‚Ä¢ Start meetings with personal check-ins\n\n**Accountability:**\n‚Ä¢ Focus on outputs, not hours\n‚Ä¢ Weekly check-ins on priorities\n‚Ä¢ Clear deadlines and owners\n\n**Trust your remote team** - they're not slacking off!"
                },
                {
                    keywords: ['conflict', 'conflict resolution', 'team conflict', 'disagreement', 'argument', 'tension'],
                    types: ['All'],
                    answer: "Resolving Team Conflict:\n\n**Your Role:** Facilitator, not judge\n\n**Step 1: Understand Each Side**\n‚Ä¢ Meet with each person separately\n‚Ä¢ Ask: 'What happened from your perspective?'\n‚Ä¢ Listen for facts vs feelings\n‚Ä¢ Don't take sides yet\n\n**Step 2: Bring Them Together**\n‚Ä¢ Neutral space, enough time\n‚Ä¢ Set ground rules: Respect, listen, focus on solution\n‚Ä¢ Each person shares their perspective\n‚Ä¢ You summarize what you heard\n\n**Step 3: Find Common Ground**\n‚Ä¢ Ask: 'What do you both want?'\n‚Ä¢ Usually they want the same outcome\n‚Ä¢ Focus on shared goals\n\n**Step 4: Co-Create Solution**\n‚Ä¢ They propose solutions, not you\n‚Ä¢ Ask: 'What would resolve this?'\n‚Ä¢ Agree on next steps\n\n**Follow Up:**\n‚Ä¢ Check in after 1 week\n‚Ä¢ Loop in HR if it's not improving"
                },
                {
                    keywords: ['new manager', 'first time manager', 'new to management', 'just promoted', 'manager advice'],
                    types: ['All'],
                    answer: "Advice for New Managers:\n\n**First 30 Days:**\n‚Ä¢ Have 1:1s with each team member\n‚Ä¢ Ask: 'What's working? What's not?'\n‚Ä¢ Listen 80%, talk 20%\n‚Ä¢ Learn the work (shadow your team)\n‚Ä¢ Find a manager mentor\n\n**Common New Manager Mistakes:**\n‚ùå Trying to be friends with everyone\n‚ùå Doing all the work yourself\n‚ùå Avoiding difficult conversations\n‚ùå Not asking for help\n‚ùå Changing everything immediately\n\n**Your New Job:**\n‚Ä¢ You're measured by your TEAM's output, not yours\n‚Ä¢ Your job is to ENABLE them, not do the work\n‚Ä¢ You set direction, they execute\n‚Ä¢ You remove blockers\n‚Ä¢ You develop people\n\n**Remember:** You don't need to know everything. You need to build a team that does.\n\n**Get help:** Find a mentor, read 'The Manager's Path', ask your manager for coaching."
                },
                {
                    keywords: ['performance', 'performance management', 'underperformance', 'low performance', 'not delivering'],
                    types: ['All'],
                    answer: "Managing Performance Issues:\n\n**Early Warning Signs:**\n‚Ä¢ Missing deadlines\n‚Ä¢ Quality dropping\n‚Ä¢ Less engaged in meetings\n‚Ä¢ Defensive when given feedback\n\n**Act Fast (Don't Wait!):**\n1. Have the conversation within 48 hours\n2. Be specific: 'In the last 2 sprints, you missed 3 deadlines'\n3. Ask: 'What's going on?'\n4. Listen for blockers (skill? motivation? personal?)\n5. Create 2-week plan with clear expectations\n6. Check in 2x/week\n\n**The Plan:**\n‚Ä¢ 2-3 specific goals\n‚Ä¢ Resources/support needed\n‚Ä¢ Check-in schedule\n‚Ä¢ Consequence if no improvement\n\n**Document Everything:**\n‚Ä¢ Date, what was discussed, agreed plan\n‚Ä¢ Follow up in writing\n‚Ä¢ CC yourself (for records)\n\n**Loop in HR early** if no improvement after 2 weeks\n\n**For Contingent Workers:** Alert their [EOR] - they handle formal performance management."
                },
                {
                    keywords: ['recognition', 'recognize', 'praise', 'appreciate', 'thank', 'kudos'],
                    types: ['All'],
                    answer: "Recognition Best Practices:\n\n**Make It Specific:**\n‚ùå Bad: 'Great job!'\n‚úÖ Good: 'You caught that bug before release and saved us 3 hours of rollback - awesome!'\n\n**The Formula:**\n[What they did] + [Impact] + [Why it matters]\n\n**When to Recognize:**\n‚Ä¢ Daily: Quick Slack kudos\n‚Ä¢ Weekly: Shoutout in team meeting\n‚Ä¢ Monthly: Bigger recognition (lunch, gift card)\n‚Ä¢ Quarterly: Formal recognition to upper management\n\n**What to Recognize:**\n‚Ä¢ Results delivered\n‚Ä¢ Helping teammates\n‚Ä¢ Going above and beyond\n‚Ä¢ Living company values\n‚Ä¢ Growth and learning\n\n**Public vs Private:**\n‚Ä¢ Praise publicly (team channel, meeting)\n‚Ä¢ Coach privately (1:1s)\n\n**Recognition ratio:** 3 positive for every 1 constructive feedback\n\n**Don't forget contingent workers!** They need recognition too."
                },
                {
                    keywords: ['coaching', 'coach', 'develop', 'development', 'grow', 'career growth'],
                    types: ['All'],
                    answer: "Coaching Your Team:\n\n**Career Development Conversations:**\n‚Ä¢ Quarterly: 'Where do you want to be in 6 months?'\n‚Ä¢ Monthly: 'What skills are you building?'\n‚Ä¢ Weekly: 'What did you learn this week?'\n\n**Coaching Questions:**\n‚Ä¢ 'What do you think you should do?'\n‚Ä¢ 'What options have you considered?'\n‚Ä¢ 'What's blocking you?'\n‚Ä¢ 'What would success look like?'\n‚Ä¢ 'What support do you need from me?'\n\n**Development Opportunities:**\n‚Ä¢ Stretch assignments\n‚Ä¢ Shadow other teams\n‚Ä¢ Lead a project\n‚Ä¢ Present at team meeting\n‚Ä¢ Teach others a skill\n\n**For Contingent Workers:**\n‚Ä¢ Focus on current project skills\n‚Ä¢ Check with [EOR] about formal training programs\n‚Ä¢ Share learning resources\n\n**Your job:** Grow people so they outgrow their role (then promote them!)"
                },
                {
                    keywords: ['hiring', 'interview', 'interviewing', 'recruit', 'candidate'],
                    types: ['All'],
                    answer: "Hiring Tips:\n\n**Before Interviewing:**\n‚Ä¢ Define must-have skills vs nice-to-have\n‚Ä¢ Write down your questions\n‚Ä¢ Coordinate with team (who asks what?)\n\n**Interview Questions:**\n‚Ä¢ Behavioral: 'Tell me about a time when...'\n‚Ä¢ Situational: 'How would you handle...'\n‚Ä¢ Technical: Skills assessment/demo\n‚Ä¢ Culture: 'What environment helps you thrive?'\n\n**Red Flags:**\nüö© Speaking badly about past employers\nüö© Taking all credit for team successes\nüö© Not asking any questions\nüö© Vague answers without examples\n\n**Green Flags:**\n‚úÖ Specific examples with results\n‚úÖ Talks about team collaboration\n‚úÖ Asks thoughtful questions\n‚úÖ Shows curiosity and growth\n\n**Hire for:**\n‚Ä¢ Attitude and learning ability\n‚Ä¢ Cultural add (not just fit)\n‚Ä¢ Potential, not just experience\n\n**For Contingent Workers:** Work with [EOR]/staffing agency on hiring process."
                },
                {
                    keywords: ['motivation', 'motivate', 'engagement', 'morale', 'energize', 'inspire'],
                    types: ['All'],
                    answer: "Quick Motivation Playbook:\n\n‚Ä¢ Shorten goals to 1-week wins\n‚Ä¢ Clarify 'definition of done'\n‚Ä¢ Swap a routine task for a visible impact task\n‚Ä¢ Schedule a 15-min unblocker 1:1\n‚Ä¢ Recognize progress publicly in team channel\n\n**For contingent workers:** Same approach! They want to deliver impact too."
                },
                {
                    keywords: ['feedback', 'coaching', 'constructive feedback', 'performance'],
                    types: ['All'],
                    answer: "Giving Feedback (SBI Model):\n\n‚Ä¢ **Situation:** When/where it happened\n‚Ä¢ **Behavior:** What they did (observable)\n‚Ä¢ **Impact:** The effect it had\n\n**Example:** 'In yesterday's client meeting (S), when you presented without context (B), the client seemed confused (I).'\n\n**For contingent workers:** Focus on deliverables. Loop in [EOR] if trends persist."
                },
                {
                    keywords: ['manage', 'managing', 'contingent', 'contractor', 'team'],
                    types: ['All'],
                    answer: "Managing Contingent Workers:\n\n**You're NOT their legal manager!**\n\n**What You CAN Do:**\n‚Ä¢ Assign daily work and projects\n‚Ä¢ Provide work direction\n‚Ä¢ Give feedback on deliverables\n\n**What to AVOID:**\n‚Ä¢ Don't conduct performance reviews\n‚Ä¢ Don't discuss their pay/benefits\n‚Ä¢ Don't promise continued employment\n\n**Route HR questions to their [EOR]**"
                },
                {
                    keywords: ['timesheet', 'time tracking', 'log time', 'clock in'],
                    types: ['All'],
                    answer: "Team Time Tracking:\n\n**Direct Hire:** Uses your company's time system\n**W2 Contingent:** Uses [EOR]'s system (may sync with yours)\n**1099 Contractors:** They track their own time - NOT in your system!\n\n**Your role:** \n‚Ä¢ W2: Approve hours, ensure accuracy\n‚Ä¢ 1099: Just approve/review deliverables (they manage their own time)\n\n**Issues?** Direct contingent workers to [EOR] support."
                },
                {
                    keywords: ['invoice', 'invoicing', 'contractor payment', '1099 payment'],
                    types: ['All'],
                    answer: "Managing 1099 Contractor Payments:\n\n**How It Works:**\n‚Ä¢ They submit invoices (not timesheets!)\n‚Ä¢ Approved invoices go to accounts payable\n‚Ä¢ Payment in 30 days typically\n‚Ä¢ NO taxes withheld (they're self-employed)\n\n**Your Role:**\n‚Ä¢ Review and approve invoices for accuracy\n‚Ä¢ Verify deliverables match invoice\n‚Ä¢ Submit to AP for payment\n\n**NOT Your Role:**\n‚Ä¢ Don't handle payment directly\n‚Ä¢ Don't discuss their rates or taxes\n‚Ä¢ Don't treat like employees\n\nQuestions? Route to accounts-payable@company.com"
                },
                {
                    keywords: ['1:1', 'one on one', 'check in', 'meeting'],
                    types: ['All'],
                    answer: "Effective 1:1s:\n\n**Quick Agenda:**\n‚Ä¢ Wins this week\n‚Ä¢ Top 3 priorities\n‚Ä¢ Blockers/risks\n‚Ä¢ What you need from me\n‚Ä¢ Recognition\n\n**Keep to 20-30 minutes weekly**\n**Capture action items and dates**\n\n**For contingent workers:** Same format works great!"
                },
                {
                    keywords: ['contractor', '1099', 'freelancer'],
                    types: ['All'],
                    answer: "Working with 1099 Contractors:\n\n**Key Differences from W2:**\n‚Ä¢ They're self-employed, NOT your employees\n‚Ä¢ Focus on DELIVERABLES, not hours/methods\n‚Ä¢ They invoice, don't get paychecks\n‚Ä¢ NO benefits, PTO, or employment perks\n‚Ä¢ You CANNOT control how/when they work\n\n**What You CAN Do:**\n‚Ä¢ Set project deadlines\n‚Ä¢ Define scope and deliverables\n‚Ä¢ Provide feedback on work quality\n\n**What You CANNOT Do:**\n‚Ä¢ Require specific hours (9-5)\n‚Ä¢ Provide equipment/training\n‚Ä¢ Treat like employees (legal risk!)\n\n**For Payment Questions:** Direct to accounts payable"
                }
            ]
        };

        // Initialize
        function init() {
            faqData = demoData;
            addWelcomeMessage(
                "Hi! üë§ I'm here to answer your employment questions. I'll figure out your type from your questions - just ask!",
                [
                    "What are my benefits?",
                    "How do I request PTO?",
                    "When do I get paid?",
                    "Who is my employer?"
                ]
            );
        }

        // UI Functions
        function toggleQuickSetup() {
            document.getElementById('quickSetup').classList.toggle('active');
        }

        function setClient(company) {
            clientCompany = company;
            updateBadges();
            addMessage(`I work at ${company}`, 'user');
            setTimeout(() => {
                addMessage(`Got it! You work at ${company}. I'll personalize my answers!`, 'bot');
            }, 500);
        }

        function setEmployer(company) {
            employerCompany = company;
            updateBadges();
            addMessage(`I'm employed by ${company}`, 'user');
            setTimeout(() => {
                addMessage(`Perfect! ${company} is your employer. I'll direct you to them for HR questions.`, 'bot');
            }, 500);
        }

        function setEmploymentType(type) {
            detectedType = type;
            
            // Clear employer if switching to 1099
            if (type === '1099') {
                employerCompany = null;
            }
            
            // Enable/disable EOR buttons based on type
            const eorButtons = document.querySelectorAll('[onclick^="setEmployer"]');
            const eorSection = eorButtons[0]?.closest('div').parentElement;
            
            if (type === '1099') {
                eorButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.4';
                    btn.style.cursor = 'not-allowed';
                });
                if (eorSection) {
                    eorSection.style.opacity = '0.5';
                }
            } else {
                eorButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                });
                if (eorSection) {
                    eorSection.style.opacity = '1';
                }
            }
            
            updateBadges();
            
            const typeLabel = type === 'W2_Contingent' ? 'W2 Contingent Worker' : 
                             '1099 Independent Contractor';
            
            addMessage(`Set my employment type: ${typeLabel}`, 'user');
            
            setTimeout(() => {
                let response = `‚úÖ Employment type set to **${typeLabel}**!`;
                
                if (type === 'W2_Contingent') {
                    response += '\n\nüìå **Important:** Set your EOR/Staffing company below (the company on your paystub). This is who handles your pay, benefits, and PTO!';
                } else if (type === '1099') {
                    response += '\n\nüìå As a 1099 contractor, you\'re self-employed. No EOR needed - just set your client company!';
                }
                
                addMessage(response, 'bot');
            }, 500);
        }

        function updateBadges() {
            const detBadge = document.getElementById('detectionBadge');
            const clientBadge = document.getElementById('clientBadge');
            const emplBadge = document.getElementById('employerBadge');

            // Only show detection badge in employee mode
            if (currentMode === 'employee' && detectedType) {
                detBadge.innerHTML = `<span class="badge badge-detection">${detectedType === 'W2_Contingent' ? 'W2 Contingent' : detectedType}</span>`;
            } else {
                detBadge.innerHTML = '';
            }

            clientBadge.innerHTML = clientCompany ? `<span class="badge badge-client">@ ${clientCompany}</span>` : '';
            emplBadge.innerHTML = employerCompany ? `<span class="badge badge-employer">Employed by: ${employerCompany}</span>` : '';
        }

        function switchMode(mode, event) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';

            const desc = document.getElementById('modeDescription');
            if (mode === 'employee') {
                desc.childNodes[0].textContent = 'Smart Employment Assistant';
                addWelcomeMessage(
                    "Hi! üë§ I'm here to answer your employment questions. I'll figure out your type from your questions - just ask!",
                    [
                        "What are my benefits?",
                        "How do I request PTO?",
                        "When do I get paid?",
                        "Who is my employer?"
                    ]
                );
            } else {
                desc.childNodes[0].textContent = 'Manager Coaching & Team Support';
                addWelcomeMessage(
                    "Hi! üëî I'm your manager coach! Ask me about:\n\n‚Ä¢ Leadership skills (productivity, delegation, communication)\n‚Ä¢ Team management (1:1s, feedback, performance)\n‚Ä¢ Coaching new managers\n‚Ä¢ Answering team's PTO/benefits questions\n\nWhat can I help with?",
                    [
                        "Team engagement tips?",
                        "How to give feedback?",
                        "Delegation strategies?",
                        "My team member wants PTO"
                    ]
                );
            }
            updateBadges();
        }

        function addWelcomeMessage(text, suggestions) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            let suggestionsHtml = '';
            if (suggestions && suggestions.length > 0) {
                suggestionsHtml = `
                    <div class="suggestions">
                        ${suggestions.map(s => `<button class="suggestion-btn" onclick="sendSuggestion('${s.replace(/'/g, "\\'")}')">${s}</button>`).join('')}
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">A</div>
                <div class="message-content">
                    ${parseMarkdown(text)}
                    ${suggestionsHtml}
                </div>
            `;
            document.getElementById('chatMessages').appendChild(messageDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }

        function sendSuggestion(message) {
            addMessage(message, 'user');
            const input = document.getElementById('chatInput');
            input.value = '';

            const messages = document.getElementById('chatMessages');
            const typing = document.createElement('div');
            typing.className = 'message bot';
            typing.innerHTML = `
                <div class="message-avatar">A</div>
                <div class="typing-indicator active">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messages.appendChild(typing);

            setTimeout(() => {
                typing.remove();
                const result = getResponse(message);
                if (typeof result === 'string') {
                    addMessage(result, 'bot');
                } else {
                    addMessageWithSuggestions(result.response, 'bot', result.suggestions);
                }
            }, 1000);
        }

        // Detection
        function detectCompanies(msg) {
            const lower = msg.toLowerCase();
            patterns.clients.forEach(c => {
                if (lower.includes(c)) clientCompany = c.charAt(0).toUpperCase() + c.slice(1);
            });
            patterns.eors.forEach(e => {
                if (lower.includes(e)) {
                    employerCompany = e.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
                }
            });
        }

        function detectType(msg) {
            const lower = msg.toLowerCase();
            let score = { '1099': 0, 'W2_Contingent': 0 };

            patterns.indicators_1099.forEach(i => { if (lower.includes(i)) score['1099'] += 2; });
            patterns.indicators_w2.forEach(i => { if (lower.includes(i)) score['W2_Contingent'] += 2; });
            patterns.indicators_contingent.forEach(i => { if (lower.includes(i)) score['W2_Contingent'] += 2; });

            const max = Math.max(score['1099'], score['W2_Contingent']);
            if (max >= 2) {
                return score['1099'] > score['W2_Contingent'] ? '1099' : 'W2_Contingent';
            }

            return null;
        }

        function detectConfusion(msg) {
            return patterns.confusion.some(s => msg.toLowerCase().includes(s));
        }

        // Matching
        function normalizeText(text) {
            let normalized = text.toLowerCase();
            Object.keys(typos).forEach(typo => {
                normalized = normalized.replace(new RegExp('\\b' + typo + '\\b', 'gi'), typos[typo]);
            });
            return normalized;
        }

        function findMatch(msg) {
            const faqs = faqData[currentMode] || [];
            const normalized = normalizeText(msg);
            let bestMatch = null;
            let bestScore = 0;

            // Filter FAQs by employment type if in employee mode
            const filteredFaqs = faqs.filter(faq => {
                if (currentMode === 'employee' && detectedType) {
                    // Only include FAQs that match the detected type or are for 'All' types
                    return faq.types.includes(detectedType) || faq.types.includes('All');
                }
                // In manager mode, include all FAQs
                return true;
            });

            // Search within filtered FAQs
            filteredFaqs.forEach(faq => {
                faq.keywords.forEach(kw => {
                    if (normalized.includes(kw.toLowerCase())) {
                        const score = 0.95;
                        if (score > bestScore) {
                            bestScore = score;
                            bestMatch = faq;
                        }
                    }
                });
            });

            return { answer: bestMatch?.answer, confidence: bestScore };
        }

        // Response generation
        function getResponse(msg) {
            const lower = normalizeText(msg);

            // Detect companies
            detectCompanies(lower);

            // Only detect type in employee mode
            if (currentMode === 'employee') {
                const type = detectType(lower);
                if (type) detectedType = type;
            }

            updateBadges();

            // Greetings
            if (lower.match(/\b(hi|hello|hey)\b/)) {
                return currentMode === 'employee'
                    ? "Hello! üòä I'll figure out your employment type from your questions. Just ask away!"
                    : "Hello! üëî I'm here to help you answer your team's employment questions!";
            }

            // Thanks
            if (lower.match(/\b(thank|thanks)\b/)) {
                return "You're welcome! üåü";
            }

            // Find matching answer
            const match = findMatch(msg);

            if (match.answer && match.confidence > 0.6) {
                let response = match.answer;

                // Smart placeholder replacement based on mode
                if (currentMode === 'manager') {
                    // Manager mode: Generic replacements (talking about team members)
                    response = response.replace(/\[EOR\]/g, 'their EOR/staffing company');
                    response = response.replace(/\[Client Company\]/g, 'your company');
                } else {
                    // Employee mode: Personalized replacements based on employment type
                    const client = clientCompany || 'your client company';
                    const eor = employerCompany || 'your EOR/staffing company';

                    if (detectedType === '1099') {
                        // 1099: No employer, just client
                        response = response.replace(/\[EOR\]/g, 'N/A (you\'re self-employed)');
                        response = response.replace(/\[Client Company\]/g, client);
                    } else if (detectedType === 'W2_Contingent') {
                        // W2 Contingent: Split between EOR and Client with specific details
                        response = response.replace(/\[Client Company\]/g, client);
                        response = response.replace(/\[EOR\]/g, eor);
                        response = response.replace(/\[BENEFITS_PROVIDER\]/g, `${eor} (your employer)`);
                        response = response.replace(/\[PTO_PROVIDER\]/g, eor);
                        response = response.replace(/\[PAYROLL_PROVIDER\]/g, eor);
                        response = response.replace(/\[TIME_SYSTEM\]/g, `${eor}'s time system (may sync with ${client}'s)`);
                        response = response.replace(/\[ACCESS_HELP\]/g, `For ${eor} portal/paystubs: Contact ${eor} support. For ${client} work systems: Contact your manager or ${client} IT.`);
                        
                        // Add EOR-specific details if we have them
                        if (employerCompany && eorBenefits[employerCompany]) {
                            const details = eorBenefits[employerCompany];
                            response = response.replace(/\[MEDICAL_PLAN\]/g, details.medical);
                            response = response.replace(/\[PTO_DAYS\]/g, details.pto_days);
                            response = response.replace(/\[MATCH_401K\]/g, details.match_401k);
                            response = response.replace(/\[ENROLLMENT_WINDOW\]/g, details.enrollment_window);
                            response = response.replace(/\[PORTAL\]/g, details.portal);
                            response = response.replace(/\[PAYROLL_SCHEDULE\]/g, details.payroll_schedule);
                        } else {
                            // Generic fallbacks if no specific EOR selected
                            response = response.replace(/\[MEDICAL_PLAN\]/g, 'varies by EOR');
                            response = response.replace(/\[PTO_DAYS\]/g, '10-20 vacation days + 5-10 sick days per year');
                            response = response.replace(/\[MATCH_401K\]/g, '3-6% match');
                            response = response.replace(/\[ENROLLMENT_WINDOW\]/g, '30-60 days from hire');
                            response = response.replace(/\[PORTAL\]/g, `${eor}'s benefits portal`);
                            response = response.replace(/\[PAYROLL_SCHEDULE\]/g, 'bi-weekly or weekly');
                        }
                    } else {
                        // Fallback: Assume W2 Contingent
                        response = response.replace(/\[Client Company\]/g, client);
                        response = response.replace(/\[EOR\]/g, eor);
                        response = response.replace(/\[BENEFITS_PROVIDER\]/g, eor);
                        response = response.replace(/\[PTO_PROVIDER\]/g, eor);
                        response = response.replace(/\[PAYROLL_PROVIDER\]/g, eor);
                        response = response.replace(/\[TIME_SYSTEM\]/g, `${eor}'s system`);
                        response = response.replace(/\[ACCESS_HELP\]/g, `Contact ${eor} support.`);
                        response = response.replace(/\[MEDICAL_PLAN\]/g, 'varies by EOR');
                        response = response.replace(/\[PTO_DAYS\]/g, '10-20 vacation days + 5-10 sick days per year');
                        response = response.replace(/\[MATCH_401K\]/g, '3-6% match');
                        response = response.replace(/\[ENROLLMENT_WINDOW\]/g, '30-60 days from hire');
                        response = response.replace(/\[PORTAL\]/g, `${eor}'s benefits portal`);
                        response = response.replace(/\[PAYROLL_SCHEDULE\]/g, 'bi-weekly or weekly');
                    }
                }

                // Add detection banner (employee mode only)
                if (currentMode === 'employee' && detectedType && detectedType !== 'Unknown') {
                    const label = detectedType === 'W2_Contingent' ? 'W2 contingent worker' : 
                                  detectedType === '1099' ? '1099 independent contractor' : 'W2 contingent worker';
                    response = `üîç Based on your question, you're a **${label}**.\n\n` + response;
                }

                // Add confusion clarification (employee mode only, ONLY for W2 Contingent)
                if (currentMode === 'employee' && detectConfusion(lower) && detectedType === 'W2_Contingent') {
                    const c = clientCompany || '[your client]';
                    const e = employerCompany || '[your EOR]';
                    response += `\n\nüí° **Quick clarification:**\n‚Ä¢ You work ON-SITE at **${c}**\n‚Ä¢ You're employed BY **${e}** (check paystub)\n‚Ä¢ ${e} handles pay/benefits - not ${c}`;
                }

                return response;
            }

            // No match found - provide helpful suggestions
            const employeeSuggestions = [
                "What are my benefits?",
                "How do I request PTO?",
                "When do I get paid?",
                "Who is my employer?"
            ];
            
            const managerSuggestions = [
                "Team engagement tips?",
                "How to delegate work?",
                "How to give feedback?",
                "Managing remote teams?"
            ];

            return {
                response: "I'm not finding a match. Try asking about:\n\n‚Ä¢ Benefits and insurance\n‚Ä¢ PTO and time off\n‚Ä¢ Payment/payroll\n‚Ä¢ Who your employer is\n‚Ä¢ Team management\n‚Ä¢ Leadership coaching (productivity, delegation, goals)\n‚Ä¢ New manager advice",
                suggestions: currentMode === 'employee' ? employeeSuggestions : managerSuggestions
            };
        }

        // Message handling
        function parseMarkdown(text) {
            // Convert **text** to <strong>text</strong>
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // Convert line breaks to <br>
            text = text.replace(/\n/g, '<br>');
            
            // Convert bullet points ‚Ä¢ to proper formatting
            text = text.replace(/^‚Ä¢ (.+)$/gm, '<div style="margin-left:20px">‚Ä¢ $1</div>');
            
            // Convert ‚úÖ ‚ùå with some spacing
            text = text.replace(/^([‚úÖ‚ùå]) (.+)$/gm, '<div style="margin:4px 0">$1 $2</div>');
            
            // Convert üîç detection badges
            text = text.replace(/üîç (.+?):/g, '<strong style="color:#667eea">üîç $1:</strong>');
            
            // Convert üí° clarification
            text = text.replace(/üí° (.+?):/g, '<strong style="color:#f59e0b">üí° $1:</strong>');
            
            // Convert üìå Important
            text = text.replace(/üìå (.+?):/g, '<strong style="color:#ef4444">üìå $1:</strong>');
            
            return text;
        }

        function addMessage(text, sender) {
            const messages = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            
            // Parse markdown for bot messages
            const content = sender === 'bot' ? parseMarkdown(text) : text.replace(/\n/g, '<br>');
            
            div.innerHTML = `
                <div class="message-avatar">${sender === 'bot' ? 'A' : 'You'}</div>
                <div class="message-content">${content}</div>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function addMessageWithSuggestions(text, sender, suggestions) {
            const messages = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            
            const content = sender === 'bot' ? parseMarkdown(text) : text.replace(/\n/g, '<br>');
            
            let suggestionsHtml = '';
            if (suggestions && suggestions.length > 0) {
                suggestionsHtml = `
                    <div class="suggestions">
                        ${suggestions.map(s => `<button class="suggestion-btn" onclick="sendSuggestion('${s.replace(/'/g, "\\'")}')">${s}</button>`).join('')}
                    </div>
                `;
            }
            
            div.innerHTML = `
                <div class="message-avatar">${sender === 'bot' ? 'A' : 'You'}</div>
                <div class="message-content">${content}${suggestionsHtml}</div>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') handleSend();
        }

        function handleSend() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (!msg) return;

            addMessage(msg, 'user');
            input.value = '';

            const messages = document.getElementById('chatMessages');
            const typing = document.createElement('div');
            typing.className = 'message bot';
            typing.innerHTML = `
                <div class="message-avatar">A</div>
                <div class="typing-indicator active">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messages.appendChild(typing);

            setTimeout(() => {
                typing.remove();
                const result = getResponse(msg);
                if (typeof result === 'string') {
                    addMessage(result, 'bot');
                } else {
                    addMessageWithSuggestions(result.response, 'bot', result.suggestions);
                }
            }, 1000);
        }

        // CSV handling (optional)
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    parseCSV(e.target.result);
                    addMessage("‚úÖ CSV loaded! Your custom Q&As are active.", 'bot');
                } catch (err) {
                    addMessage("‚ùå Error loading CSV. Check format.", 'bot');
                }
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const parsed = { employee: [], manager: [] };

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const parts = line.split('","');
                if (parts.length < 4) continue;

                const keywords = parts[1].replace(/"/g, '').split(';').map(k => k.trim());
                const types = parts[2].replace(/"/g, '').split(';').map(t => t.trim());
                const answer = parts[3].replace(/^"|"$/g, '').replace(/\\n/g, '\n');
                const mode = (parts[4] || 'employee').replace(/"/g, '').trim();

                parsed[mode].push({ keywords, types, answer });
            }

            faqData = parsed;
        }

        // Boot
        window.onload = init;
    </script>
</body>
</html>
