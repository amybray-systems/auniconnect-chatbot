<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aunikah - Smart Employment Assistant</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display:flex; flex-direction:column; padding:20px;
    }
    .chat-container {
      width:100%; max-width:900px; height:calc(100vh - 40px);
      background:white; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.3);
      display:flex; flex-direction:column; overflow:hidden; margin:0 auto;
    }
    .chat-header { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px; }
    .header-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:15px; }
    .header-info { display:flex; align-items:center; gap:15px; }
    .bot-avatar {
      width:50px; height:50px; background:white; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:24px; font-weight:bold; color:#667eea;
    }
    .header-text h1 { font-size:22px; margin-bottom:5px; }
    .header-text p { font-size:14px; opacity:0.9; }
    .badge { display:inline-block; padding:4px 10px; border-radius:12px; font-size:11px; font-weight:600; margin-left:8px; }
    .badge-detection { background:rgba(255,255,255,0.3); }
    .badge-client { background:rgba(66,153,225,0.3); }
    .badge-employer { background:rgba(159,122,234,0.3); }
    .mode-selector { display:flex; gap:10px; }
    .mode-btn {
      padding:8px 16px; background:rgba(255,255,255,0.2); border:2px solid rgba(255,255,255,0.3);
      border-radius:20px; color:white; cursor:pointer; font-size:13px; transition:all 0.3s;
    }
    .mode-btn:hover { background:rgba(255,255,255,0.3); }
    .mode-btn.active { background:white; color:#667eea; border-color:white; }
    .demo-notice { background:rgba(255,255,255,0.15); padding:12px; border-radius:10px; font-size:13px; }
    .demo-notice strong { display:block; margin-bottom:5px; }
    .quick-setup {
      background:white; border-radius:10px; padding:15px; margin-top:10px; color:#333; display:none;
    }
    .quick-setup.active { display:block; }
    .quick-setup h3 { font-size:14px; margin-bottom:10px; color:#667eea; }
    .company-buttons { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .company-btn {
      padding:6px 12px; background:#f0f4ff; border:1px solid #667eea; border-radius:6px;
      cursor:pointer; font-size:12px; color:#667eea; transition:all 0.2s;
    }
    .company-btn:hover { background:#667eea; color:white; }
    .chat-messages { flex:1; overflow-y:auto; padding:20px; background:#f8f9fa; }
    .message { display:flex; gap:10px; margin-bottom:15px; animation:slideIn 0.3s ease; }
    @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .message.user { flex-direction:row-reverse; }
    .message-avatar {
      width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-weight:bold; color:white; flex-shrink:0; font-size:14px;
    }
    .message.bot .message-avatar { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
    .message.user .message-avatar { background:#6c757d; }
    .message-content { max-width:70%; padding:12px 16px; border-radius:12px; line-height:1.6; }
    .message.bot .message-content { background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); color:#333; }
    .message.bot .message-content strong { font-weight:600; color:#667eea; }
    .message.user .message-content { background:#667eea; color:white; }
    .typing-indicator { display:none; padding:15px; background:white; border-radius:12px; width:fit-content; }
    .typing-indicator.active { display:flex; gap:4px; }
    .typing-dot { width:8px; height:8px; border-radius:50%; background:#667eea; animation:typing 1.4s infinite; }
    .typing-dot:nth-child(2){ animation-delay:0.2s; }
    .typing-dot:nth-child(3){ animation-delay:0.4s; }
    @keyframes typing { 0%,60%,100%{transform:translateY(0);} 30%{transform:translateY(-10px);} }
    .chat-input-container { padding:20px; background:white; border-top:1px solid #e9ecef; }
    .chat-input-wrapper { display:flex; gap:10px; }
    .chat-input {
      flex:1; padding:12px 20px; border:2px solid #e9ecef; border-radius:25px; font-size:15px; outline:none; transition:border-color 0.2s;
    }
    .chat-input:focus { border-color:#667eea; }
    .send-btn, .csv-btn {
      padding:12px 24px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border:none; border-radius:25px;
      cursor:pointer; font-weight:bold; transition:transform 0.2s; font-size:14px;
    }
    .csv-btn { background:#f0f4ff; color:#667eea; padding:8px 16px; font-size:12px; }
    .send-btn:hover, .csv-btn:hover { transform:scale(1.05); }
    .send-btn:disabled { opacity:0.5; cursor:not-allowed; }
    .suggestions { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .suggestion-btn {
      padding:8px 15px; background:#f0f4ff; border:1px solid #667eea; border-radius:20px; cursor:pointer; font-size:13px;
      color:#667eea; transition:all 0.2s; font-weight:500;
    }
    .suggestion-btn:hover { background:#667eea; color:white; transform:translateY(-2px); box-shadow:0 4px 8px rgba(102,126,234,0.2); }
    @media (max-width:768px) {
      .chat-container { height:100vh; border-radius:0; }
      .message-content { max-width:85%; }
      .mode-selector { flex-direction:column; gap:5px; }
    }
    .footer { text-align:center; padding:15px; color:rgba(255,255,255,0.9); font-size:14px; font-weight:500; }
  </style>
</head>
<body>
  <div style="max-width:900px;margin:0 auto 20px;background:rgba(255,255,255,0.95);padding:15px 20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="color:#667eea;margin:0 0 8px 0;font-size:20px;">üëã Welcome to Aunikah</h2>
    <p style="color:#666;margin:0 0 10px 0;font-size:14px;line-height:1.5;">
      AI-powered HR assistant that detects worker classification (W-2 vs 1099) and provides personalized responses. Try asking about benefits, PTO, or payroll!
    </p>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <span style="background:#f0f4ff;color:#667eea;padding:3px 10px;border-radius:12px;font-size:12px;">üß† Smart detection</span>
      <span style="background:#f0f4ff;color:#667eea;padding:3px 10px;border-radius:12px;font-size:12px;">‚öñÔ∏è Compliance-aware</span>
      <span style="background:#f0f4ff;color:#667eea;padding:3px 10px;border-radius:12px;font-size:12px;">üíº Manager mode</span>
    </div>
  </div>

  <div class="chat-container">
    <div class="chat-header">
      <div class="header-top">
        <div class="header-info">
          <div class="bot-avatar">A</div>
          <div class="header-text">
            <h1>Aunikah</h1>
            <p id="modeDescription">
              Smart Employment Assistant
              <span id="detectionBadge"></span>
              <span id="clientBadge"></span>
              <span id="employerBadge"></span>
            </p>
          </div>
        </div>
        <div class="mode-selector">
          <button class="mode-btn active" onclick="switchMode('employee', event)">üë§ Employee</button>
          <button class="mode-btn" onclick="switchMode('manager', event)">üëî Manager</button>
        </div>
      </div>

      <div class="demo-notice">
        <strong>üß† Smart Detection Active</strong>
        I'll detect your employment type from your questions, or use Quick Setup for instant demo!
        <button onclick="toggleQuickSetup()" style="background:rgba(255,255,255,0.3);border:none;color:white;padding:4px 12px;border-radius:12px;cursor:pointer;font-size:11px;margin-left:10px">Quick Setup</button>
        <button onclick="resetType()" style="background:rgba(255,255,255,0.3);border:none;color:white;padding:4px 12px;border-radius:12px;cursor:pointer;font-size:11px;margin-left:10px">Reset Type</button>
        <div style="margin-top:8px;font-size:11px;opacity:0.9;">
          ‚ö†Ô∏è <strong>Demo Only:</strong> All company names, benefits, and policies shown are fictional examples for demonstration purposes and do not reflect actual employer or client benefits.
        </div>
        <div style="margin-top:4px;font-size:11px;opacity:0.9;">
          üîé Guidance only. For legal, tax, or personal benefit decisions, please refer to your employer/EOR or a qualified professional.
        </div>
      </div>

      <div class="quick-setup" id="quickSetup">
        <h3>Quick Demo Setup</h3>
        <p style="font-size:11px;color:#666;margin-bottom:15px;font-style:italic">
          ‚öôÔ∏è Demo only: In production, the system auto-detects employment type from assignment data
        </p>

        <div style="margin-bottom:15px">
          <strong style="font-size:12px;color:#667eea">Employment Type</strong>
          <div class="company-buttons" style="margin-top:5px">
            <button class="company-btn" onclick="setEmploymentType('W2_Contingent')">W-2 Contingent</button>
            <button class="company-btn" onclick="setEmploymentType('1099')">1099 Contractor</button>
          </div>
        </div>

        <div style="margin-bottom:10px">
          <strong style="font-size:12px;color:#666">Where do you work? (Client)</strong>
          <div class="company-buttons">
            <button class="company-btn" onclick="setClient('UnBungle')">UnBungle</button>
            <button class="company-btn" onclick="setClient('Micro Operators')">Micro Operators</button>
            <button class="company-btn" onclick="setClient('Amazing Floors')">Amazing Floors</button>
            <button class="company-btn" onclick="setClient('Metadata TechCo')">Metadata TechCo</button>
          </div>
        </div>

        <div>
          <strong style="font-size:12px;color:#666">Who employs you? (EOR/Staffing)</strong>
          <p style="font-size:10px;color:#999;margin:2px 0 5px 0">‚ö†Ô∏è Only for W-2 contingent workers (disabled for 1099)</p>
          <div class="company-buttons">
            <button class="company-btn" onclick="setEmployer('Employee Stand')">Employee Stand</button>
            <button class="company-btn" onclick="setEmployer('ADevco')">ADevco</button>
            <button class="company-btn" onclick="setEmployer('People Power')">People Power</button>
            <button class="company-btn" onclick="setEmployer('People Lite')">People Lite</button>
          </div>
        </div>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages"></div>

    <div class="chat-input-container">
      <div class="chat-input-wrapper">
        <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything..." onkeypress="handleKeyPress(event)">
        <button class="send-btn" onclick="handleSend()">Send</button>
      </div>
    </div>
  </div>

  <div class="footer">
    ¬© <span id="year"></span> Amy Bray. All rights reserved.
  </div>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ---------- State ----------
    let currentMode = 'employee';
    let clientCompany = null;
    let employerCompany = null;
    let detectedType = null;
    let manualTypeSet = false;
    let faqData = null;

    // ---------- Helpers: Empathy & CARE ----------
    function needsEmpathy(msg) {
      const m = (msg || '').toLowerCase();
      return /(confus|frustrat|upset|angry|mad|annoy|why.*not|no one told|help|urgent|asap)/.test(m);
    }
    function wrapTone(baseText, msg) {
      const intro = needsEmpathy(msg) ? "I can help clarify and point you to the right place. " : "";
      return intro + baseText;
    }
    function careFormat({clarify, action, route, evidence}) {
      let out = "";
      if (clarify) out += `**What this means:** ${clarify}\n\n`;
      if (action)  out += `**Next steps:** ${action}\n\n`;
      if (route)   out += `**Who to contact:** ${route}\n\n`;
      if (evidence)out += `**Where to check:** ${evidence}\n`;
      return out.trim();
    }

    // ---------- EOR-specific benefit details ----------
    const eorBenefits = {
      'Employee Stand': {
        medical: 'Blue Cross Blue Shield PPO',
        pto_days: '15 vacation + 10 sick days',
        match_401k: '4% match (100% vested after 1 year)',
        enrollment_window: '30 days from hire or November open enrollment',
        portal: 'MyEmployee Stand benefits portal',
        payroll_schedule: 'Bi-weekly (every other Friday)'
      },
      'ADevco': {
        medical: 'Aetna HMO or PPO options',
        pto_days: '10 vacation + 5 sick days (increases after 2 years)',
        match_401k: '3% match (50% vested immediately)',
        enrollment_window: '60 days from hire or during annual enrollment',
        portal: 'ADevco Associate Portal',
        payroll_schedule: 'Weekly (every Friday)'
      },
      'People Power': {
        medical: 'United Healthcare Choice Plus',
        pto_days: '12 vacation + 8 sick days',
        match_401k: '5% match (vested immediately)',
        enrollment_window: '30 days from start date',
        portal: 'People PowerGroup MyPath',
        payroll_schedule: 'Bi-weekly (Fridays)'
      },
      'People Lite': {
        medical: 'Cigna Open Access Plus',
        pto_days: '20 vacation + 10 sick days',
        match_401k: '6% match (100% vested)',
        enrollment_window: '45 days from hire',
        portal: 'PL Connect Benefits Hub',
        payroll_schedule: 'Bi-weekly (Thursdays)'
      }
    };

    // ---------- Typos mapping ----------
    const typos = {
      'benifits':'benefits','benfits':'benefits','bennefits':'benefits',
      'vaccation':'vacation','vacaton':'vacation',
      'insurence':'insurance','insuranse':'insurance',
      'holliday':'holiday','sallary':'salary',
      'payed':'paid','pade':'paid',
      'timeoff':'time off','sicke':'sick'
    };

    // ---------- Detection patterns ----------
    const patterns = {
      indicators_1099: ['invoice','invoicing','bill','quarterly taxes','my rate','freelance','deduct'],
      indicators_w2: ['paycheck','paystub','withholding','pto','benefits enrollment','clock in'],
      indicators_contingent: ['staffing','eor','placed at','assignment','my recruiter'],
      confusion: ['my manager at','my boss at','i work for'],
      clients: ['UnBungle','Micro Operators','Amazing Floors','Metadata TechCo'],
      eors: ['Employee Stand','ADevco','People Power','People Lite']
    };

    // ---------- Demo FAQ data (softened tone + IDs) ----------
    const demoData = {
      employee: [
        {
          id: 'emp_who_eor_w2',
          keywords: ['eor','employer of record','staffing','agency','who is my employer'],
          types: ['W2_Contingent'],
          answer: "üìã **Understanding Your W-2 Contingent Employment**\n\n**Who's your employer?**\nCheck your paystub‚Äîthe company listed there is your legal employer.\n\n**As a W-2 Contingent worker:**\n‚Ä¢ You do your work at **[Client Company]**\n‚Ä¢ **[EOR]** is on your paystub (e.g., Employee Stand, ADevco, People Power)\n‚Ä¢ **[EOR]** = your legal employer (pay, benefits, taxes)\n‚Ä¢ **[Client Company]** = where you do the work\n\n**Who handles what:**\n‚Ä¢ Pay, benefits, PTO, taxes, W-2 ‚Üí **[EOR]**\n‚Ä¢ Daily work, tasks, projects ‚Üí your supervisor at **[Client Company]**\n\nAuniConnect helps you route questions to the right place."
        },
        {
          id: 'emp_benefits_w2',
          keywords: ['benefits','insurance','health','medical','dental','vision'],
          types: ['W2_Contingent'],
          answer: "W-2 Contingent Benefits\n\n**Benefits provider:** [BENEFITS_PROVIDER]\n\n**Health Insurance:**\n‚Ä¢ Medical: [MEDICAL_PLAN]\n‚Ä¢ Dental and Vision included\n‚Ä¢ [ENROLLMENT_WINDOW]\n\n**Retirement:**\n‚Ä¢ 401(k) with [MATCH_401K]\n\n**Time Off:**\n‚Ä¢ [PTO_DAYS]\n\n**How to enroll:**\nUse **[PORTAL]** or contact your benefits team."
        },
        {
          id: 'emp_pto_w2',
          keywords: ['pto','vacation','time off','request time off','take time off'],
          types: ['W2_Contingent'],
          answer: "PTO for W-2 Contingent\n\n**PTO managed by:** [PTO_PROVIDER]\n\n**Your PTO:**\n‚Ä¢ [PTO_DAYS]\n‚Ä¢ Vacation: request ~2+ weeks in advance\n‚Ä¢ Sick time: same-day when needed\n\n**How to request:**\nSubmit in **[PORTAL]**. Your client manager handles scheduling; **[PTO_PROVIDER]** confirms eligibility/balance."
        },
        {
          id: 'emp_payroll_w2',
          keywords: ['pay','paycheck','paid','salary','wage','when do i get paid','payday'],
          types: ['W2_Contingent'],
          answer: "W-2 Contingent Payroll\n\n**Who pays you:** **[PAYROLL_PROVIDER]** (see your paystub)\n\n**Pay schedule:**\n‚Ä¢ [PAYROLL_SCHEDULE]\n‚Ä¢ Direct deposit supported\n‚Ä¢ Taxes withheld automatically\n\n**Paystubs:**\nView anytime in **[PORTAL]**."
        },
        {
          id: 'emp_time_w2',
          keywords: ['timesheet','time','log time','track time','clock in','log hours','enter time'],
          types: ['W2_Contingent'],
          answer: "Time Tracking (W-2 Contingent)\n\n**Where to log time:** [TIME_SYSTEM]\n\n**How it works:**\n‚Ä¢ Clock in/out or add hours in the portal\n‚Ä¢ Submit weekly (e.g., Friday 5pm)\n‚Ä¢ Manager approves\n\n**Access help:**\n[ACCESS_HELP]"
        },
        {
          id: 'emp_benefits_1099',
          keywords: ['benefits','insurance','health','medical','dental','vision'],
          types: ['1099'],
          answer: "1099 Contractor ‚Äî Benefits & Coverage\n\nAs an independent contractor, you typically arrange your own coverage and retirement.\n\n**What clients usually don't provide:**\n‚Ä¢ Health insurance\n‚Ä¢ 401(k) matching\n‚Ä¢ Paid time off\n\n**Your options:**\n‚Ä¢ Healthcare.gov or private plans\n‚Ä¢ Solo 401(k) or SEP-IRA\n‚Ä¢ Disability insurance\n‚Ä¢ Consider pricing your rate to cover time off and benefits\n\nIf you're unsure about your status, check January tax forms (1099 vs W-2) or your payment method (invoice vs paycheck)."
        },
        {
          id: 'emp_pto_1099',
          keywords: ['pto','vacation','time off'],
          types: ['1099'],
          answer: "1099 Time Off\n\nIndependent contractors usually take unpaid time off.\n\n**Good practices:**\n‚Ä¢ Give your client notice (ideally 2+ weeks)\n‚Ä¢ Align on deliverables/timelines\n‚Ä¢ Don't bill for days off\n‚Ä¢ Build time-off buffers into your rate"
        },
        {
          id: 'emp_time_1099',
          keywords: ['timesheet','time','log time','track time','log hours','enter time'],
          types: ['1099'],
          answer: "1099 Time Tracking\n\nYou can track time in a way that fits your business.\n\n**Common approaches:**\n‚Ä¢ Spreadsheet or apps (Toggl, Harvest)\n‚Ä¢ Track for invoices and tax records\n‚Ä¢ Client may request a system for visibility‚Äîyour invoice remains authoritative"
        },
        {
          id: 'emp_payment_1099',
          keywords: ['invoice','bill','payment','get paid','invoicing'],
          types: ['1099'],
          answer: "1099 Payments\n\n**Typical flow:**\n‚Ä¢ Submit invoices to your client (per milestone or cadence)\n‚Ä¢ Common terms: Net 30\n‚Ä¢ No tax withholding‚Äîplan for quarterly taxes if applicable\n\n**Invoice includes:**\n‚Ä¢ Business name, services, units/hours, rate, total, terms\n\n**Tip:** Many contractors set aside ~25‚Äì30% for taxes (confirm with a tax pro)."
        },
        {
          id: 'emp_who_1099',
          keywords: ['eor','employer of record','staffing','agency','who is my employer'],
          types: ['1099'],
          answer: "1099 Status Overview\n\nIndependent contractors are self-employed. Your client is not your employer; you provide services under a contract and invoice for payment.\n\nIf you're unsure whether you're 1099 or W-2, check whether you receive paystubs with tax withholdings (W-2) or issue invoices (1099)."
        }
      ],
      manager: [
        {
          id: 'mgr_pto',
          keywords: ['pto','time off','team pto','approve pto','vacation'],
          types: ['All'],
          answer: "Answering Team PTO Questions\n\n**For W-2 Contingent:** PTO policy is set by their **[EOR]**. As the client manager, you approve scheduling/coverage; the EOR confirms eligibility and balance.\n\n**For 1099:** Time off is typically unpaid; align on deliverables and timelines."
        },
        {
          id: 'mgr_benefits',
          keywords: ['benefits','insurance','team benefits','health insurance'],
          types: ['All'],
          answer: "Team Benefits Questions\n\n**W-2 Contingent:** Benefits are handled by the worker's **[EOR]** (see paystub).\n**1099:** Contractors usually arrange their own coverage.\n\nIf there's confusion, ask the worker to confirm the company name on their paystub or January form."
        },
        {
          id: 'mgr_payroll',
          keywords: ['payroll','paycheck','pay issue','salary'],
          types: ['All'],
          answer: "Team Payroll Questions\n\n**W-2 Contingent:** Payroll is handled by the worker's **[EOR]**. You can approve hours; payroll questions route to the EOR payroll team.\n**1099:** Contractors submit invoices to Accounts Payable per agreed terms."
        },
        {
          id: 'mgr_feedback',
          keywords: ['feedback','give feedback','providing feedback','how to give feedback'],
          types: ['All'],
          answer: "Giving Effective Feedback\n\n**Positive Feedback (Recognition):**\n‚Ä¢ Be specific: \"Your proposal included clear ROI analysis\"\n‚Ä¢ State impact: \"This helped leadership make a faster decision\"\n‚Ä¢ Timely: Within 24-48 hours of the achievement\n‚Ä¢ Public when possible\n "I'd like to give a shoutout to Abby, Mary and Claude for showing up everyday and making such a positive impact on our community!"\n**Constructive Feedback (Growth):**\n‚Ä¢ Private setting, timely conversation\n‚Ä¢ SBI Model:\n  - **Situation:** \"In yesterday's client meeting...\"\n  - **Behavior:** \"...when you interrupted the client twice...\"\n  - **Impact:** \"...they seemed frustrated and we lost momentum\"\n‚Ä¢ Focus on actions, not character\n‚Ä¢ Ask: \"What's your perspective?\" (listen actively)\n‚Ä¢ Collaborate: \"What could work better next time?\"\n‚Ä¢ End with support: \"I'm here to help you succeed\"\n\n**General principles:**\n‚Ä¢ Balance: Aim for 3-5 positive interactions per constructive one\n‚Ä¢ Regular rhythm: Don't save it all for reviews\n‚Ä¢ Follow up: Check in on progress\n‚Ä¢ Document: Keep notes for performance conversations"
        },
        {
          id: 'mgr_productivity',
          keywords: ['productivity','productive','efficiency','get more done','time management'],
          types: ['All'],
          answer: "Productivity Tips for Managers\n\n**Personal:**\n‚Ä¢ Block deep work\n‚Ä¢ Batch similar tasks\n‚Ä¢ Quiet hours for focus\n\n**Team:**\n‚Ä¢ 3 priorities/week\n‚Ä¢ Short async updates vs status meetings\n‚Ä¢ Celebrate visible wins"
        },
        {
          id: 'mgr_prioritization',
          keywords: ['prioritize','priorities','prioritization','what to focus on','too much work'],
          types: ['All'],
          answer: "Prioritization Framework (2√ó2)\n‚Ä¢ Urgent+Important = Do now\n‚Ä¢ Important+Not urgent = Schedule\n‚Ä¢ Urgent+Not important = Delegate\n‚Ä¢ Neither = Remove\n\nTeam ritual: Set top 3 weekly ‚Üí midweek check ‚Üí Friday review."
        },
        {
          id: 'mgr_delegation',
          keywords: ['delegate','delegation','delegating','empower','give work'],
          types: ['All'],
          answer: "Delegation Guide\n\n**Delegate:** repeatable ops, growth tasks\n**Keep:** reviews, sensitive HR, strategy, 1:1s\n**How:** outcome first, context/why, check-ins, then avoid over-directing once expectations are clear."
        },
        {
          id: 'mgr_communication',
          keywords: ['communication','communicate','clear communication','messaging'],
          types: ['All'],
          answer: "Clear Communication (3Cs)\n‚Ä¢ **Clear:** what exactly\n‚Ä¢ **Concise:** keep it tight\n‚Ä¢ **Context:** why it matters\n\nChannel fit: Slack ‚Üî quick; Email ‚Üî decisions; Meeting ‚Üî discussion."
        },
        {
          id: 'mgr_meetings',
          keywords: ['meetings','too many meetings','meeting overload','run meetings','facilitate'],
          types: ['All'],
          answer: "Meeting Management\n\nBefore: could this be async?\nDuring: start on time, agenda, owner, notes & owners by when.\nAfter: send action items."
        },
        {
          id: 'mgr_goals',
          keywords: ['goals','goal setting','objectives','okr','targets','kpi'],
          types: ['All'],
          answer: "Goal Setting\n\nPick 1‚Äì3 weekly, make them SMART, assign owner & deadline. Post Monday ‚Üí check Wednesday ‚Üí celebrate Friday."
        },
        {
          id: 'mgr_difficult',
          keywords: ['difficult conversation','tough conversation','confrontation','uncomfortable','sensitive topic'],
          types: ['All'],
          answer: "Difficult Conversations\n\nOpen with facts, explain impact, listen, agree on what changes by when, document, follow up."
        },
        {
          id: 'mgr_trust',
          keywords: ['trust','build trust','team trust','psychological safety'],
          types: ['All'],
          answer: "Building Team Trust\n\nAdmit what you don't know, keep commitments, give credit publicly, address blockers quickly."
        },
        {
          id: 'mgr_remote',
          keywords: ['remote','remote team','hybrid','distributed','virtual team','work from home'],
          types: ['All'],
          answer: "Managing Remote Teams\n\nDocument decisions, default to async, rotate times, record/share notes, focus on outputs not hours."
        },
        {
          id: 'mgr_conflict',
          keywords: ['conflict','conflict resolution','team conflict','disagreement','argument','tension'],
          types: ['All'],
          answer: "Resolving Team Conflict\n\nUnderstand both sides, bring together with ground rules, find shared goals, co-create solution, follow up."
        },
        {
          id: 'mgr_new_manager',
          keywords: ['new manager','first time manager','new to management','just promoted','manager advice'],
          types: ['All'],
          answer: "New Manager Basics\n\nFirst 30 days: listen, learn, set 1:1s, find a mentor, don't change everything at once. Your job is enabling output and growth."
        },
        {
          id: 'mgr_performance',
          keywords: ['performance','performance management','underperformance','low performance','not delivering'],
          types: ['All'],
          answer: "Managing Performance\n\nAddress early, be specific, agree on 2-week plan, check in twice weekly, document, involve HR if not improving. For W-2 contingent, loop in their **[EOR]** early."
        },
        {
          id: 'mgr_recognition',
          keywords: ['recognition','recognize','praise','appreciate','thank','kudos'],
          types: ['All'],
          answer: "Recognition That Sticks\n\nSay what they did + impact + why it matters. Praise publicly; coach privately."
        },
        {
          id: 'mgr_coaching',
          keywords: ['coaching','coach','develop','development','grow','career growth'],
          types: ['All'],
          answer: "Coaching\n\nUse questions: options, blockers, success definition, supports. Offer stretch work, shadowing, presenting."
        },
        {
          id: 'mgr_manage_contingent',
          keywords: ['manage','managing','contingent','contractor','team'],
          types: ['All'],
          answer: "Managing Contingent Workers\n\nDirect daily work/deliverables. Avoid pay/benefits discussions or employment promises. Route HR items to the worker's **[EOR]**."
        },
        {
          id: 'mgr_time_tracking',
          keywords: ['timesheet','time tracking','log time','clock in'],
          types: ['All'],
          answer: "Team Time Tracking\n\n**W-2 contingent:** log time in **[EOR]** system; you approve.\n**1099:** contractors track their own time; you verify deliverables."
        },
        {
          id: 'mgr_invoices',
          keywords: ['invoice','invoicing','contractor payment','1099 payment'],
          types: ['All'],
          answer: "Managing 1099 Payments\n\nContractor invoices ‚Üí Accounts Payable per terms. You approve accuracy vs deliverables; AP handles payment."
        },
        {
          id: 'mgr_1on1',
          keywords: ['1:1','one on one','check in','meeting'],
          types: ['All'],
          answer: "Effective 1:1s\n\nAgenda: wins, top 3, blockers, support, recognition. Capture actions & dates."
        },
        {
          id: 'mgr_1099_basics',
          keywords: ['contractor','1099','freelancer'],
          types: ['All'],
          answer: "Working with 1099 Contractors\n\nFocus on scope, deliverables, deadlines. Don't set hours or methods; route payment questions to AP."
        }
      ]
    };

    // ---------- Init ----------
    function init() {
      faqData = demoData;
      addWelcomeMessage(
        "Hi! üë§ I'm here to answer your employment questions. I'll figure out your type from your selections above‚Äîjust ask!",
        ["What are my benefits?", "How do I request PTO?", "When do I get paid?", "Who is my employer?"]
      );
    }

    // ---------- UI ----------
    function toggleQuickSetup(){ document.getElementById('quickSetup').classList.toggle('active'); }

    function setClient(company) {
      clientCompany = company;
      updateBadges();
      addMessage(`I work at ${company}`,'user');
      setTimeout(()=> addMessage(`Got it! You work at ${company}. I'll personalize my answers.`, 'bot'), 500);
    }

    function setEmployer(company) {
      employerCompany = company;
      updateBadges();
      addMessage(`I'm employed by ${company}`,'user');
      setTimeout(()=> addMessage(`Thanks! ${company} is your employer. I'll route HR questions their way.`, 'bot'), 500);
    }

    function setEmploymentType(type) {
      detectedType = type; manualTypeSet = true;
      if (type === '1099') { employerCompany = null; }
      const eorButtons = document.querySelectorAll('[onclick^="setEmployer"]');
      const eorSection = eorButtons[0]?.closest('div').parentElement;
      if (type === '1099') {
        eorButtons.forEach(btn => { btn.disabled = true; btn.style.opacity='0.4'; btn.style.cursor='not-allowed'; });
        if (eorSection) eorSection.style.opacity='0.5';
      } else {
        eorButtons.forEach(btn => { btn.disabled = false; btn.style.opacity='1'; btn.style.cursor='pointer'; });
        if (eorSection) eorSection.style.opacity='1';
      }
      updateBadges();
      const typeLabel = type === 'W2_Contingent' ? 'W-2 Contingent Worker' : '1099 Independent Contractor';
      addMessage(`Set my employment type: ${typeLabel}`,'user');
      setTimeout(()=>{
        let response = `‚úÖ Employment type set to **${typeLabel}**!`;
        if (type === 'W2_Contingent') {
          response += '\n\nüìå **Important:** Set your EOR/staffing company below (the name on your paystub). They handle your pay, benefits, and PTO.';
        } else {
          response += "\n\nüìå As a 1099 contractor, you're self-employed. No EOR needed‚Äîjust set your client company.";
        }
        addMessage(response,'bot');
      }, 500);
    }

    function updateBadges() {
      const detBadge = document.getElementById('detectionBadge');
      const clientBadge = document.getElementById('clientBadge');
      const emplBadge = document.getElementById('employerBadge');
      if (currentMode === 'employee' && detectedType) {
        detBadge.innerHTML = `<span class="badge badge-detection">${detectedType === 'W2_Contingent' ? 'W-2 Contingent' : detectedType}</span>`;
      } else detBadge.innerHTML = '';
      clientBadge.innerHTML = clientCompany ? `<span class="badge badge-client">@ ${clientCompany}</span>` : '';
      emplBadge.innerHTML = employerCompany ? `<span class="badge badge-employer">Employed by: ${employerCompany}</span>` : '';
    }

    function switchMode(mode, event){
      currentMode = mode; manualTypeSet = false;
      document.querySelectorAll('.mode-btn').forEach(btn=>btn.classList.remove('active'));
      event.target.classList.add('active');
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.innerHTML = '';
      const desc = document.getElementById('modeDescription');
      if (mode==='employee') {
        desc.childNodes[0].textContent = 'Smart Employment Assistant';
        addWelcomeMessage(
          "Hi! üë§ I'm here to answer your employment questions. I'll figure out your type from your selections above‚Äîjust ask!",
          ["What are my benefits?","How do I request PTO?","When do I get paid?","Who is my employer?"]
        );
      } else {
        desc.childNodes[0].textContent = 'Manager Coaching & Team Support';
        addWelcomeMessage(
          "Hi! üëî I'm your manager coach. Ask me about:\n\n‚Ä¢ Leadership skills (productivity, delegation, communication)\n‚Ä¢ Team management (1:1s, feedback, performance)\n‚Ä¢ Coaching new managers\n‚Ä¢ Answering team PTO/benefits questions\n\nWhat can I help with?",
          ["Team engagement tips?","How to give feedback?","Delegation strategies?","My team member wants PTO"]
        );
      }
      updateBadges();
    }

    function resetType() {
      detectedType = null; manualTypeSet = false; clientCompany = null; employerCompany = null;
      updateBadges();
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.innerHTML = '';
      addWelcomeMessage(
        "Type detection reset! I'll figure out your employment type from your selections above‚Äîjust ask!",
        ["What are my benefits?","How do I request PTO?","When do I get paid?","Who is my employer?"]
      );
    }

    function addWelcomeMessage(text, suggestions){
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot';
      let suggestionsHtml = '';
      if (suggestions?.length) {
        suggestionsHtml = `
          <div class="suggestions">
            ${suggestions.map(s => `<button class="suggestion-btn" onclick="sendSuggestion('${s.replace(/'/g,"\\'")}')">${s}</button>`).join('')}
          </div>`;
      }
      messageDiv.innerHTML = `
        <div class="message-avatar">A</div>
        <div class="message-content">
          ${parseMarkdown(text)}
          ${suggestionsHtml}
        </div>`;
      const container = document.getElementById('chatMessages');
      container.appendChild(messageDiv);
      container.scrollTop = container.scrollHeight;
    }

    function sendSuggestion(message){
      addMessage(message,'user');
      const input = document.getElementById('chatInput'); input.value='';
      const messages = document.getElementById('chatMessages');
      const typing = document.createElement('div');
      typing.className = 'message bot';
      typing.innerHTML = `
        <div class="message-avatar">A</div>
        <div class="typing-indicator active">
          <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
        </div>`;
      messages.appendChild(typing);
      setTimeout(()=>{
        typing.remove();
        const result = getResponse(message);
        if (typeof result === 'string') {
          addMessage(wrapTone(result, message), 'bot');
        } else {
          addMessageWithSuggestions(wrapTone(result.response, message), 'bot', result.suggestions);
        }
      }, 900);
    }

    // ---------- Detection ----------
    function detectCompanies(msg){
      const lower = msg.toLowerCase();
      patterns.clients.forEach(c=>{ if(lower.includes(c.toLowerCase())) clientCompany = c; });
      patterns.eors.forEach(e=>{
        if (lower.includes(e.toLowerCase())) employerCompany = e;
      });
    }
    function detectType(msg){
      const lower = msg.toLowerCase();
      let score = {'1099':0,'W2_Contingent':0};
      patterns.indicators_1099.forEach(i=>{ if(lower.includes(i)) score['1099']+=2; });
      patterns.indicators_w2.forEach(i=>{ if(lower.includes(i)) score['W2_Contingent']+=2; });
      patterns.indicators_contingent.forEach(i=>{ if(lower.includes(i)) score['W2_Contingent']+=2; });
      const max = Math.max(score['1099'], score['W2_Contingent']);
      if (max>=2) return score['1099']>score['W2_Contingent'] ? '1099' : 'W2_Contingent';
      return null;
    }
    function detectConfusion(msg){ return patterns.confusion.some(s=> msg.toLowerCase().includes(s)); }

    // ---------- Matching ----------
    function normalizeText(text){
      let normalized = text.toLowerCase();
      Object.keys(typos).forEach(typo=>{
        normalized = normalized.replace(new RegExp('\\b'+typo+'\\b','gi'), typos[typo]);
      });
      return normalized;
    }

    function findMatch(msg){
      const faqs = faqData[currentMode] || [];
      const normalized = normalizeText(msg);
      let bestMatch = null; let bestScore = 0;

      const filteredFaqs = faqs.filter(faq=>{
        if (currentMode==='employee' && detectedType) {
          return faq.types.includes(detectedType) || faq.types.includes('All');
        }
        return true;
      });

      filteredFaqs.forEach(faq=>{
        faq.keywords.forEach(kw=>{
          if (normalized.includes(kw.toLowerCase())) {
            const score = 0.95;
            if (score>bestScore){ bestScore = score; bestMatch = faq; }
          }
        });
      });
      return { faq: bestMatch, confidence: bestScore };
    }

    // ---------- Response generation ----------
    function getResponse(msg){
      const lower = normalizeText(msg);

      // Detect companies
      detectCompanies(lower);

      // Only detect type in employee mode if not set manually
      if (currentMode==='employee' && !manualTypeSet){
        const type = detectType(lower); if (type) detectedType = type;
      }

      updateBadges();

      // Greetings
      if (lower.match(/\b(hi|hello|hey)\b/)) {
        return currentMode==='employee'
          ? "Hello! üòä I'll figure out your employment type from your selections above. Just ask away!"
          : "Hello! üëî I'm here to help you with your team questions.";
      }

      // Thanks
      if (lower.match(/\b(thank|thanks)\b/)) return "You're welcome! üåü";

      // Attempt match
      const match = findMatch(msg);
      if (match.faq && match.confidence>0.6){
        let response = match.faq.answer;

        // Personalization
        if (currentMode==='manager'){
          response = response.replace(/\[EOR\]/g,'their EOR/staffing company')
                             .replace(/\[Client Company\]/g,'your company');
        } else {
          const client = clientCompany || 'your client company';
          const eor = employerCompany || 'your EOR/staffing company';

          if (detectedType==='1099'){
            response = response.replace(/\[EOR\]/g,"N/A (self-employed)")
                               .replace(/\[Client Company\]/g, client);
          } else if (detectedType==='W2_Contingent'){
            response = response.replace(/\[Client Company\]/g, client)
                               .replace(/\[EOR\]/g, eor)
                               .replace(/\[BENEFITS_PROVIDER\]/g, `${eor} (your employer)`)
                               .replace(/\[PTO_PROVIDER\]/g, eor)
                               .replace(/\[PAYROLL_PROVIDER\]/g, eor)
                               .replace(/\[TIME_SYSTEM\]/g, `${eor}'s time system (may sync with ${client})`)
                               .replace(/\[ACCESS_HELP\]/g, `For ${eor} portal/paystubs: contact ${eor} support. For ${client} systems: your manager or ${client} IT.`);
            // EOR specifics
            if (employerCompany && eorBenefits[employerCompany]){
              const d = eorBenefits[employerCompany];
              response = response.replace(/\[MEDICAL_PLAN\]/g, d.medical)
                                 .replace(/\[PTO_DAYS\]/g, d.pto_days)
                                 .replace(/\[MATCH_401K\]/g, d.match_401k)
                                 .replace(/\[ENROLLMENT_WINDOW\]/g, d.enrollment_window)
                                 .replace(/\[PORTAL\]/g, d.portal)
                                 .replace(/\[PAYROLL_SCHEDULE\]/g, d.payroll_schedule);
            } else {
              response = response.replace(/\[MEDICAL_PLAN\]/g,'varies by EOR')
                                 .replace(/\[PTO_DAYS\]/g,'10‚Äì20 vacation + 5‚Äì10 sick days/year')
                                 .replace(/\[MATCH_401K\]/g,'3‚Äì6% match')
                                 .replace(/\[ENROLLMENT_WINDOW\]/g,'30‚Äì60 days from hire')
                                 .replace(/\[PORTAL\]/g, `${eor} benefits portal`)
                                 .replace(/\[PAYROLL_SCHEDULE\]/g,'bi-weekly or weekly');
            }
          } else {
            // Fallback assume W-2 Contingent conventions
            response = response.replace(/\[Client Company\]/g, client)
                               .replace(/\[EOR\]/g, eor)
                               .replace(/\[BENEFITS_PROVIDER\]/g, eor)
                               .replace(/\[PTO_PROVIDER\]/g, eor)
                               .replace(/\[PAYROLL_PROVIDER\]/g, eor)
                               .replace(/\[TIME_SYSTEM\]/g, `${eor}'s system`)
                               .replace(/\[ACCESS_HELP\]/g, `Contact ${eor} support.`)
                               .replace(/\[MEDICAL_PLAN\]/g,'varies by EOR')
                               .replace(/\[PTO_DAYS\]/g,'10‚Äì20 vacation + 5‚Äì10 sick days/year')
                               .replace(/\[MATCH_401K\]/g,'3‚Äì6% match')
                               .replace(/\[ENROLLMENT_WINDOW\]/g,'30‚Äì60 days from hire')
                               .replace(/\[PORTAL\]/g, `${eor} benefits portal`)
                               .replace(/\[PAYROLL_SCHEDULE\]/g,'bi-weekly or weekly');
          }
        }

        // Prepend softer detection banner (employee only)
        if (currentMode==='employee' && detectedType && detectedType!=='Unknown'){
          const label = detectedType==='W2_Contingent' ? 'W-2 contingent worker' :
                        detectedType==='1099' ? '1099 independent contractor' : 'W-2 contingent worker';
          response = `üîç Based on your question, you **might be** a **${label}**. If that's right, here's how it works:\n\n` + response;
        }

        // Clarify common confusion (employee mode + W2)
        if (currentMode==='employee' && detectConfusion(lower) && detectedType==='W2_Contingent'){
          const c = clientCompany || '[your client]';
          const e = employerCompany || '[your EOR]';
          response += `\n\nüí° **Quick clarification:**\n‚Ä¢ You do your day-to-day work at **${c}**\n‚Ä¢ You're employed by **${e}** (see your paystub)\n‚Ä¢ **${e}** manages pay/benefits; **${c}** manages work`;
        }

        // Add CARE blocks for key W-2 topics
        if (currentMode==='employee' && detectedType==='W2_Contingent'){
          if (['emp_benefits_w2','emp_pto_w2','emp_payroll_w2'].includes(match.faq.id)){
            if (!employerCompany){
              response += `\n\nüîé Not sure who your EOR is? Check the **company name on your paystub**‚Äîthat's the team that manages your benefits and payroll.`;
            }
            if (match.faq.id==='emp_benefits_w2'){
              response += "\n\n" + careFormat({
                clarify: "Your employer of record (EOR) offers and administers your benefits.",
                action: "Review plan options and complete enrollment by the stated window.",
                route: `Benefits support via ${employerCompany || 'your EOR'} portal`,
                evidence: "Your paystub and EOR portal list plan and employer details."
              });
            }
            if (match.faq.id==='emp_pto_w2'){
              response += "\n\n" + careFormat({
                clarify: "PTO policy comes from your EOR; your client manager approves scheduling/coverage.",
                action: "Submit the request in your EOR portal and align dates with your client manager.",
                route: `PTO policy & balance in ${employerCompany || 'EOR'} portal`,
                evidence: "See PTO accruals/requests in the portal; check approvals in email."
              });
            }
            if (match.faq.id==='emp_payroll_w2'){
              response += "\n\n" + careFormat({
                clarify: "Your EOR runs payroll and withholds taxes.",
                action: "Verify your pay schedule and direct deposit details.",
                route: `Payroll support via ${employerCompany || 'your EOR'} portal`,
                evidence: "Your paystub shows the employer name and pay schedule."
              });
            }
          }
        }

        return response;
      }

      // Fallback with clarifying question
      const employeeSuggestions = ["What are my benefits?","How do I request PTO?","When do I get paid?","Who is my employer?"];
      const managerSuggestions = ["Team engagement tips?","How to delegate work?","How to give feedback?","Managing remote teams?"];
      return {
        response: "I didn't find a direct match. I can help with benefits, PTO, payroll, employer/EOR, or manager topics.\n\nQuick question: are you a **W-2 contingent employee** (paid by an EOR) or a **1099 contractor**?",
        suggestions: currentMode==='employee' ? employeeSuggestions : managerSuggestions
      };
    }

    // ---------- Message handling ----------
    function parseMarkdown(text){
      text = text.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
      text = text.replace(/\n/g,'<br>');
      text = text.replace(/^‚Ä¢ (.+)$/gm,'<div style="margin-left:20px">‚Ä¢ $1</div>');
      text = text.replace(/^([‚úÖ‚ùå]) (.+)$/gm,'<div style="margin:4px 0">$1 $2</div>');
      text = text.replace(/üîç (.+?):/g,'<strong style="color:#667eea">üîç $1:</strong>');
      text = text.replace(/üí° (.+?):/g,'<strong style="color:#f59e0b">üí° $1:</strong>');
      text = text.replace(/üìå (.+?):/g,'<strong style="color:#ef4444">üìå $1:</strong>');
      return text;
    }

    function addMessage(text, sender){
      const messages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      const content = sender==='bot' ? parseMarkdown(text) : text.replace(/\n/g,'<br>');
      div.innerHTML = `
        <div class="message-avatar">${sender==='bot' ? 'A' : 'You'}</div>
        <div class="message-content">${content}</div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    function addMessageWithSuggestions(text, sender, suggestions){
      const messages = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      const content = sender==='bot' ? parseMarkdown(text) : text.replace(/\n/g,'<br>');
      let suggestionsHtml = '';
      if (suggestions?.length){
        suggestionsHtml = `
          <div class="suggestions">
            ${suggestions.map(s => `<button class="suggestion-btn" onclick="sendSuggestion('${s.replace(/'/g,"\\'")}')">${s}</button>`).join('')}
          </div>`;
      }
      div.innerHTML = `
        <div class="message-avatar">${sender==='bot' ? 'A' : 'You'}</div>
        <div class="message-content">${content}${suggestionsHtml}</div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    function handleKeyPress(e){ if (e.key==='Enter') handleSend(); }

    function handleSend(){
      const input = document.getElementById('chatInput');
      const msg = input.value.trim();
      if (!msg) return;
      addMessage(msg,'user'); input.value='';
      const messages = document.getElementById('chatMessages');
      const typing = document.createElement('div');
      typing.className = 'message bot';
      typing.innerHTML = `
        <div class="message-avatar">A</div>
        <div class="typing-indicator active">
          <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
        </div>`;
      messages.appendChild(typing);
      setTimeout(()=>{
        typing.remove();
        const result = getResponse(msg);
        if (typeof result === 'string') {
          addMessage(wrapTone(result, msg), 'bot');
        } else {
          addMessageWithSuggestions(wrapTone(result.response, msg), 'bot', result.suggestions);
        }
      }, 900);
    }

    // ---------- CSV (optional; unchanged wiring points present) ----------
    function handleCSVUpload(event){
      const file = event.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = (e)=>{
        try { parseCSV(e.target.result); addMessage("‚úÖ CSV loaded! Your custom Q&As are active.", 'bot'); }
        catch(err){ addMessage("‚ùå Error loading CSV. Check format.", 'bot'); }
      };
      reader.readAsText(file);
    }

    function parseCSV(text){
      const lines = text.split('\n');
      const parsed = { employee:[], manager:[] };
      for (let i=1; i<lines.length; i++){
        const line = lines[i].trim(); if(!line) continue;
        const parts = line.split('","'); if (parts.length<4) continue;
        const keywords = parts[1].replace(/"/g,'').split(';').map(k=>k.trim());
        const types = parts[2].replace(/"/g,'').split(';').map(t=>t.trim());
        const answer = parts[3].replace(/^"|"$/g,'').replace(/\\n/g,'\n');
        const mode = (parts[4] || 'employee').replace(/"/g,'').trim();
        parsed[mode].push({ keywords, types, answer });
      }
      faqData = parsed;
    }

    // Boot
    window.onload = init;
  </script>
</body>
</html>

